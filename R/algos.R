#---------#---------#---------#---------#---------#---------#---------#---------
#install.packages('stringr')
library(stringr)

load('~/Learning/marketModeling/data/myHistoric.RData')
head(df)
tail(df)

get.daily.change <- function(x) {
  (x[2:length(x)] - x[1:(length(x) - 1)]) / x[1:(length(x) - 1)]
}


prev.last <- dim(df)[1]


sp.actual <- c(
  df$sp.actual,   5827,  5836,  5843,  5950,  5937,  5997,  6049,  6086,  6119,
    6101,  6012,  6068,  6039,  6071,  6041,  5995,  6038,  6061,  6084,  6025,
    6066,  6069,  6052,  6115,  6115,  6125,  6144,  6118,  6013,  5983,  5955,
    5956,  5862,  5955,  5850,  5778,  5843,  5739,  5770,  5615,  5572,  5599,
    5522,  5639,  5675,  5615,  5675,  5663,  5668,  5768,  5777,  5712,  5693,
    5581,  5612,  5633,  5671,  5397,  5074,  5062,  4983,  5457,  5268,  5363,
    5406,  5397,  5276,  5283,  5158,  5288,  5376,  5485,  5525,  5529,  5561,
    5569,  5625,  5687,  5650,  5607,  5631,  5664,  5660,  5844,  5887,  5893,
    5917,  5958,  5964,  5940,  5845,  5842,  5803,  5922,  5889,  5912,  5912,
    5936,  5970,  5971,  5939,  6000,  6006,  6039,  6022,  6045,  5977,  6033,
    5983,  5981,  5968,  6025,  6092,  6092,  6141,  6173,  6205,  6198,  6227,
    6279,  6230,  6226,  6263,  6280,  6260,  6269,  6244,  6264,  6297,  6297,
    6306,  6310,  6359,  6363,  6389,  6390,  6371,  6363,  6339,  6238,  6330,
    6299,  6345,  6340,  6389)

fid.in <- c( 
  df$fid.in,    172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,172299,
  172299,172299,172299,172299) #
fid.val <- c(
  df$fid.val,   259076,259900,260932,262076,263078,263121,264259,264409,265029,
  264323,265178,266072,266541,268886,266966,266306,266836,267983,268732,266087,
  268507,268281,268110,270148,268388,269065,268667,266446,263805,263235,261933,
  261355,258084,259909,256280,256129,258779,253878,256583,249283,249278,252498,
  247741,254830,256844,252872,256130,254530,255483,262252,262641,259418,258463,
  254475,254696,256898,259615,247740,235096,236236,232208,254986,245157,249202,
  251208,250909,246028,246262,242723,246765,250792,255511,257496,257617,259128,
  259119,259728,262891,262544,261711,262288,263646,263556,272303,273330,272552,
  273369,274484,274513,274401,271929,272372,271498,274995,273522,274194,274144,
  274490,275589,276288,275995,277970,278815,280617,279786,279950,276958,278421,
  275923,275483,275031,277021,279283,278082,278870,280200,280901,282880,283566,
  284286,282133,283039,284051,284559,283042,283111,281528,282446,283566,282966,
  282493,284652,286688,285324,286278,285425,283205,283109,280771,279221,281708,
  279616,279857,280889,282561) #

f1k.in <- c(
  df$f1k.in,     52664, 52664, 52664, 52664, 53385, 53385, 53385, 53385, 53385,
   54088, 54088, 54088, 54088, 54088, 54088, 54088, 54088, 54088, 54794, 54794,
   54794, 54794, 54794, 54794, 54794, 54794, 54794, 54794, 55489, 55489, 55489,
   55489, 55489, 55489, 55489, 55489, 55489, 55489, 55489, 55489, 55489, 55489,
   55489, 55489, 56261, 56261, 56261, 56261, 56261, 56261, 56261, 56261, 56261,
   56261, 56261, 56261, 56261, 57018, 57018, 57018, 57018, 57018, 57018, 57018,
   57018, 57018, 57018, 57018, 57018, 57018, 57018, 57018, 57018, 57018, 57018,
   57018, 57018, 57018, 57018, 57018, 57018, 57760, 57760, 57760, 57760, 57760,
   57760, 57760, 57760, 57760, 57760, 57760, 57760, 57760, 57760, 57760, 57760,
   57760, 57760, 57760, 58451, 58451, 58451, 58451, 58451, 58451, 58451, 58451,
   58451, 58451, 58451, 58451, 58451, 58451, 58451, 58451, 58451, 58451, 58451,
   59110, 59110, 59110, 59110, 59110, 59110, 59110, 59110, 59110, 59765, 59765,
   59765, 59765, 59765, 59765, 59765, 59765, 59765, 59765, 59765, 59765, 59765,
   60423, 60423, 60423, 60423) # (1125.13)
f1k.val <- c(
  df$f1k.val,    82324, 82169, 82228, 82282, 83645, 83548, 84187, 84966, 85417,
   86877, 86687, 85482, 86377, 86028, 86597, 86145, 85505, 86165, 87586, 86826,
   87055, 87728, 87640, 87666, 88496, 88400, 88401, 88703, 89247, 87588, 87074,
   86512, 86566, 84856, 86022, 84215, 83600, 85664, 84111, 84519, 81975, 81798,
   82429, 80876, 82952, 83761, 82618, 84794, 84480, 84617, 86436, 86506, 85319,
   84878, 83133, 83241, 83671, 85478, 81210, 76795, 76828, 75614, 82965, 80023,
   81333, 81939, 81825, 81268, 81290, 79490, 81267, 82751, 84577, 85237, 85261,
   85632, 85669, 86207, 87403, 87011, 86420, 87710, 88356, 88246, 91106, 91755,
   91925, 92182, 92751, 92850, 92520, 92163, 92296, 91684, 93379, 92891, 93181,
   93148, 93520, 94071, 95552, 95232, 96020, 96059, 96548, 96353, 96510, 95358,
   96276, 95510, 96545, 96283, 97179, 98345, 98224, 98905, 99520, 99940, 99835,
  101506,102360,101638,101578,102137,102181,101721,101818,101549,102948,103481,
  103459,103484,103544,104239,104062,104468,104471,104085,104173,103628,102170,
  103772,103196,104918,104972) #

self.mng.in <- c(
  df$self.mng.in,13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857,
   13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857,
   13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857,
   13857, 13857, 13857, 13857, 13857, 17835, 17835, 17835, 17835, 17835, 17835,
   17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835,
   17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835,
   17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835,
   17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835,
   17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835,
   17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835,
   17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835, 17835,
   17835, 25017, 25017, 25017, 25017, 25017, 25017, 25017, 25017, 25017, 25017,
   25017, 25017, 25017, 25017, 25017, 25017, 25017, 25017, 25017, 25017, 25017,
   25017, 25017, 25017, 25017)  # 
self.mng.val <- c(
  df$self.mng.val, 
                 17468, 17480, 17547, 17681, 17776, 17783, 17934, 17906, 17923,
   17937, 17950, 17966, 17951, 18100, 17981, 17925, 18049, 18151, 18153, 18079,
   18230, 18310, 18420, 18626, 18544, 18695, 18750, 18598, 18341, 18240, 18122,
   18091, 17754, 17846, 17434, 17415, 22661, 22389, 22488, 21777, 21853, 22120,
   21613, 22269, 22704, 22274, 22682, 22508, 22536, 23233, 23172, 22806, 22608,
   22134, 22032, 22171, 22506, 21255, 20404, 20498, 20104, 22026, 21235, 21465,
   21666, 21612, 21313, 21421, 21056, 21420, 21804, 22310, 22421, 22432, 22492,
   22435, 22534, 22791, 22735, 22597, 22582, 22825, 22790, 23448, 23590, 23535,
   23532, 23645, 23628, 23584, 23316, 23407, 23319, 23605, 23494, 23479, 23449,
   23473, 23611, 23703, 23709, 23925, 23969, 24090, 24013, 23986, 23694, 23905,
   23690, 23761, 23739, 23956, 24222, 24051, 24147, 24272, 24336, 24529, 24718,
   24833, 34677, 34735, 34826, 34815, 34590, 34570, 34413, 34585, 34748, 34728,
   34669, 34910, 35110, 34970, 35080, 34991, 34846, 34788, 34541, 34332, 34761,
   34664, 34721, 34833, 34743)  #

et.in <- c(
  df$et.in,      92607, 92997, 93120, 93120, 93120, 93120, 93120, 93120, 93120,
   93120, 93120, 93120, 93120, 93330, 93330, 93330, 93330, 93330, 93330, 93330,
   93330, 93330, 93330, 93474, 93474, 93474, 93474, 93474, 93474, 93867, 94356,
   94356, 94849, 94849, 94849, 95147, 95147, 95147, 95147, 95147, 95818, 95818,
   95937, 95937, 95937, 95937, 95937, 95937, 95937, 95937, 95937, 95937, 95937,
   96450, 96450, 96450, 96450, 98251,100213,100213,100682,100682,100682,100682,
  100912,100912,100912,100912,100912,100912,100912,100912,100912,100912,101315,
  101315,101315,101315,101315,101315,101315,101315,101315,101315,101315,101654,
  101654,101654,101654,101654,101654,101654,101654,101654,101654,101985,101985,
  101985,101985,101985,101985,101985,101985,101985,101985,101985,101985,101985,
  101985, 97875, 97875, 97875, 97875, 97875, 97875, 98410, 98410, 98410, 98410,
   98410, 98410, 98410, 98410, 98410, 98410, 98626, 98626, 98626, 98626, 98626,
   98626, 98626, 98626, 98626, 98626, 98626, 98626, 98626, 98745, 98745, 98745,
   98745, 98745, 98745, 98745) #
et.val <-c(
  df$et.val,    211043,212988,214224,214870,216300,216008,216174,216336,216595,
  215513,217232,218083,218359,220065,218102,217139,217036,217815,218562,215875,
  217701,217972,217679,219633,217747,216918,216923,215338,213512,214406,215088,
  214842,213440,215769,211701,211811,213685,208814,211161,204546,206256,209575,
  205102,211458,212928,208711,211230,209235,209926,216520,216205,212795,211339,
  208292,208411,211009,213769,202953,199460,201342,199256,218767,209756,213676,
  215922,215335,210983,211269,208168,211803,215335,219756,221733,221859,223950,
  223956,224161,227143,226662,225667,225822,226709,226374,233827,234689,234604,
  235338,236638,236856,236965,234870,235118,234290,237479,236160,237574,237442,
  237290,238238,238709,238172,239329,240919,242985,242020,242433,239954,241008,
  238466,228618,228464,229906,231427,230224,230657,232784,233054,234651,235571,
  235573,233350,234202,234874,236231,235141,235651,233882,234625,235635,235021,
  234417,236683,238589,237172,238027,237199,234937,235334,233318,231329,233189,
  230619,230615,231814,233675) #

sim1 <- (c(
         100000,100000,100181,100920,102382,102281,101603,103160,104907,104306,
  104823,106238,107565,107041,109842,109042,107404,107212,110907,112705,111026,
  113902,110691,109092,109888,107978,109033,109033,106661,105044,103855,104994,
  106595, 99771,101143, 95632, 95166, 97095, 92383, 93447, 86507, 89072, 93245,
   87294, 92401, 94503, 90356, 94051, 92502, 94408,100349,100298, 97681, 96326,
   93529, 93442, 94987, 96996, 84851, 74901, 77763, 75090, 87882, 79527, 82968,
   85183, 83912, 80515, 80017, 77403, 80511, 83294, 86908, 88464, 88985, 91201,
   91242, 91113, 94887, 94623, 93567, 93235, 94706, 95794,105800,105180,103525,
  104985,105704,106202,106143,103183,103445,101947,105561,104480,102809,102852,
  102560,104696,106303,104270,105848,107065,107121,106545,106189,102800,105199,
  102062,102399,103549,105966,109236,106811,108164,109202,111272,112507,112875,
  114173,111960,112125,113282,113496,111768,112606,112128,113659,114965,114971,
  114795,116277,118622,117838,118995,119044,130218,131213,128875,126610,130534,
  128148,131833,131631,123693)
  / 100000)
sim1.res <- -1114
mw <- read.csv('~/Downloads/Holdings - Damian Satterthwaite-Phillips.csv')
mw$Value <- str_replace(mw$Value, ",", "")
mw$Value <- as.numeric(str_replace(mw$Value, "\\$", ""))
sim1.val <- sum(mw$Value)
sim1.name <- 'adelaide'

sim2 <- (c(
         100000,100000,100158,100885,102728,102840,102406,104599,106418,105942,
  106168,106180,109058,108848,110943,109775,107708,107689,109993,111953,109278,
  111321,108203,107087,109465,109914,114203,114203,111413,108263,106084,104194,
  107459,101726,102048, 95862, 96433, 97906, 91932, 93096, 87305, 90154, 93564,
   87291, 93629, 96691, 91832, 95760, 93989, 96026,101238,101461, 98644, 96648,
   93091, 92681, 94614, 97022, 84129, 74476, 76026, 73545, 91893, 83187, 85830,
   87328, 86915, 82951, 83498, 80618, 84392, 87615, 92325, 94544, 95013, 97204,
   98225, 98350,102945,102364,101661,101666,103959,104647,115068,115939,114904,
  115959,117101,116941,116935,112705,112834,111766,115517,114066,112071,112411,
  112913,115031,116087,115452,117518,117768,117696,117231,116822,112143,115014,
  111009,112497,113782,115911,119583,117897,120217,121262,124209,125653,126419,
  128053,125439,125445,125810,126303,124161,124841,124460,125585,127127,125694,
  125272,127425,130711,129675,131456,129950,128547,130886,127837,124843,128193,
  126008,129479,129081,121780)
  / 100000)
sim2.res <- 33010
mw <- read.csv('~/Downloads/Holdings - Damian Satterthwaite-Phillips(1).csv')
mw$Value <- str_replace(mw$Value, ",", "")
mw$Value <- as.numeric(str_replace(mw$Value, "\\$", ""))
sim2.val <- sum(mw$Value)
sim2.name <- 'boisterous'

sim3 <- (c(
         100000,100000,100368,101189,102743,102670,102045,103523,105270,104372,
  104101,105513,107951,107052,109536,108744,106686,106743,110295,111389,108375,
  108678,107977,105346,108174,106194,108843,108843,106548,109798,108570,105940,
  107653,100876,101690, 97486, 97629, 99421, 95709, 98280, 93997, 94152, 94379,
   90535, 94619, 98534, 97148, 99559, 96462, 96604, 99618, 98917, 96959, 97144,
   94667, 97075, 97355, 99442, 95553, 86233, 83953, 79991, 91942, 90172, 92544,
   93797, 93264, 91451, 92699, 89720, 93083, 93341, 96962, 97740, 98677, 98879,
  100247, 99391,103081,102724, 98608, 98392,101296,100486,105945,108927,108551,
  109230,111643,111901,111242,107104,107130,105868,108527,107305,107294,107832,
  108213,110279,111840,110733,112616,113362,114197,113607,112858,108195,110958,
  107192,106963,105381,107923,112321,111646,113205,113365,115548,114577,115490,
  117121,115389,115254,116966,116441,114127,115540,114281,116328,118391,118204,
  117184,116393,119417,119299,121075,121267,133696,132934,130082,129629,134753,
  134430,136515,136528,135075)
  / 100000)
sim3.res <- -832
mw <- read.csv('~/Downloads/Holdings - Damian Satterthwaite-Phillips(2).csv')
mw$Value <- str_replace(mw$Value, ",", "")
mw$Value <- as.numeric(str_replace(mw$Value, "\\$", ""))
sim3.val <- sum(mw$Value)
sim3.name <- 'cantankerous'


sim4 <- (c(
         100000,100000,100403,101316,103055,102786,102118,103324,104838,103757,
  103325,105111,106746,106348,109165,108556,106282,106247,109595,111455,108656,
  109590,108722,106499,110335,108146,110844,110844,108496,113240,112673,109393,
  110120,106259,107288,102506,102410,102956, 98081,100882, 94809, 95977, 99419,
   92178, 97754, 99753, 95185, 98773, 96755, 98748,104460,104824,101361, 98789,
   95433, 95495, 97685, 99853, 85487, 75022, 77792, 75048, 92045, 82852, 86024,
   88252, 87200, 83710, 83422, 80164, 83555, 86316, 91000, 93355, 93665, 95646,
   95115, 95501, 99247, 99024, 97916, 97471, 99893,101872,112303,112142,110761,
  111856,112662,113338,113787,109800,109945,108650,112503,111207,109111,109228,
  109122,111736,113743,112003,113386,115331,115828,115257,114871,111260,113895,
  109715,110193,111158,114256,117062,115151,116739,117389,119619,120331,120908,
  122386,119912,120107,121527,121610,120072,121001,120487,122216,123485,123422,
  123032,124583,127125,126283,127491,127761,139398,140667,138376,135961,140166,
  137813,142373,142115,133099)
  / 100000)
sim4.res <- 9286
mw <- read.csv('~/Downloads/Holdings - Damian Satterthwaite-Phillips(3).csv')
mw$Value <- str_replace(mw$Value, ",", "")
mw$Value <- as.numeric(str_replace(mw$Value, "\\$", ""))
sim4.val <- sum(mw$Value)
sim4.name <- 'deeelite'

sim5 <- (c(
         100000,100000,100329,101080,102579,102888,102376,104699,106291,106069,
  105501,106753,108745,108704,110745,109261,106735,106840,109390,110814,107887,
  109289,107924,107408,110091,109686,111857,111857,109423,108935,107752,106739,
  107837,103843,104795, 99577, 99140,101146, 95783, 97220, 91911, 93789, 97338,
   91695, 98056,101523, 96790,100652, 98850,100448,106316,106341,102724,100948,
   96663, 96570, 98145,100981, 87656, 76843, 78239, 75542, 91000, 83165, 85488,
   87459, 87264, 83796, 83634, 80714, 84642, 87635, 92692, 94168, 94484, 97025,
   98656, 99445,102498,102002,100908,101288,103422,103946,112971,114811,114080,
  113675,113821,113567,113098,109861,110221,108997,113609,112312,109704,109232,
  110912,112269,113596,111725,115434,114480,113391,113506,111695,107384,111690,
  108168,109232,109104,111784,115484,112710,114938,115937,118939,119861,120626,
  122511,120523,121137,121691,121294,118962,119677,119346,120516,122372,120741,
  121268,123413,125852,125053,126297,124774,122994,125583,123490,120748,123754,
  121460,125111,124263,117886)
  / 100000)
sim5.res <- 12801
mw <- read.csv('~/Downloads/Holdings - Damian Satterthwaite-Phillips(4).csv')
mw$Value <- str_replace(mw$Value, ",", "")
mw$Value <- as.numeric(str_replace(mw$Value, "\\$", ""))
sim5.val <- sum(mw$Value)
sim5.name <- 'edjucated'

extr <- (c(
         100000,100000,100000,100497,101274,101045,100579,101267,101191,101483,
   99729, 99185,101753,100747,103563,101707, 98628, 98969,103628,106584,102428,
  107160,101994, 99580,101897,102595,111417,111417,107488,102407, 97749, 93230,
  100231, 94367, 96022, 89898, 88809, 91493, 85395, 88217, 82404, 83606, 86002,
   83217, 88937, 89904, 86645, 89867, 88796, 89465, 95782, 96066, 90150, 87898,
   83953, 82181, 84059, 87958, 74659, 67133, 67339, 64448, 79813, 73044, 74452,
   75507, 74869, 71099, 71215, 67041, 70824, 74630, 80175, 83495, 83638, 85698,
   85832, 88646, 91965, 91235, 90259, 90208, 92495, 92005,102205,107304,107665,
  107274,109215,108780,109492,104964,105386,105430,111742,109980,114175,114301,
  115243,118864,119507,116880,119579,119492,119722,121953,123512,120599,123469,
  119880,119597,118033,123707,125803,125769,127907,129224,130449,129359,132964,
  136609,131509,131112,132876,131862,129566,128948,127830,129754,132777,134905,
  132961,135695,139662,138870,144117,160107,158438,158324,152442,151991,155389,
  150356,153961,151030,152068)
  / 100000)
extr.res <- 1098
#mw <- read.csv('~/Downloads/Holdings - Damian Satterthwaite-Phillips(5).csv')
#mw$Value <- str_replace(mw$Value, ",", "")
#mw$Value <- as.numeric(str_replace(mw$Value, "\\$", ""))
#extr.val <- sum(mw$Value)
#extr.name <- 'extrema'


normalize.to.index <- function(x, index) {
	x / x[index]
}


sp <- normalize.to.index(sp.actual, prev.last)
spd <- get.daily.change(sp)
fid <- fid.val / fid.in
fid <- normalize.to.index(fid, prev.last)
fidd <- get.daily.change(fid)
f1k <- f1k.val / f1k.in
f1k <- normalize.to.index(f1k, prev.last)
self.mng <- self.mng.val / self.mng.in
self.mng <- normalize.to.index(self.mng, prev.last)
self.mng.d <- get.daily.change(self.mng)
et <- et.val / et.in
et <- normalize.to.index(et, prev.last)
etd <- get.daily.change(et)
tot.in <- fid.in + f1k.in + et.in
tot.val <- fid.val + f1k.val + et.val
tot <- tot.val / tot.in
tot <- normalize.to.index(tot, prev.last)
mine.in <- fid.in + et.in + self.mng.in
mine.val <- fid.val + et.val + self.mng.val
mine <- mine.val / mine.in
mine <- normalize.to.index(mine, prev.last)

# Calculate Sharpe Ratios
get.sharpe.ratio <- function(returns, window=length(returns), rnd=3, ignore0=F) {
  if (length(returns) > window) {
    returns <- returns[(length(returns) - window):length(returns)]	  	
  }	
  returns <- returns[!is.na(returns)]
  if (ignore0) {
  	retruns <- returns[returns != 0]
  }
  round((sqrt(252) * mean(returns)) / sd(returns), rnd)
}


get.daily.returns <- function(x) { 
  n <- length(x)
  x[2:n] / x[1:(n - 1)] - 1 
}

get.sharpe.from.daily.values <- function(x, rnd=3, ignore0=F) {
  x <- x[!is.na(x)]
  get.sharpe.ratio(get.daily.returns(x), rnd=rnd, ignore0=ignore0)
}



m <- length(sp)
n <- length(sp) - prev.last
prev <- m - n
this.year <- (prev):m
days <- -prev:(n - 1) + 1
new.days <- 0:(n - 1)
year.start <- length(tot) - length(new.days)

sp.sh       <- get.sharpe.from.daily.values(sp[this.year])
self.mng.sh <- get.sharpe.from.daily.values(self.mng[this.year], ignore0=T)
tot.sh      <- get.sharpe.from.daily.values(tot[this.year])
mine.sh     <- get.sharpe.from.daily.values(mine[this.year])
f1k.sh      <- get.sharpe.from.daily.values(f1k[this.year]) 
fid.sh      <- get.sharpe.from.daily.values(fid[this.year]) 
et.sh       <- get.sharpe.from.daily.values(et[this.year])
sim1.sh     <- get.sharpe.from.daily.values(sim1)
sim2.sh     <- get.sharpe.from.daily.values(sim2)
sim3.sh     <- get.sharpe.from.daily.values(sim3)
sim4.sh     <- get.sharpe.from.daily.values(sim4)
sim5.sh     <- get.sharpe.from.daily.values(sim5)
extr.sh     <- get.sharpe.from.daily.values(extr)


# PLOT 1: This year's returns ---------------------------------------------------
plot(
  days, 
  sp / sp[year.start], 
  type='l', 
  col='orange',
  lwd=3, 
  xlim=range(days[days >= 0]), 
  ylim=c(0.6, 1.7),
  log='y')
abline(h=seq(0, 8, 0.1), lty=2, col=rgb(0, 0, 0, 0.2))
abline(h=seq(0, 8, 0.5), lty=4, col=rgb(0, 0, 0, 0.8))
abline(v=0, lwd=2)
lines(days, tot / tot[year.start], lwd=3)
lines(days, mine / mine[year.start], col='cadetblue', lwd=3)
lines(days, fid / fid[year.start], col='darkgreen', lwd=3)
lines(days, et / et[year.start], col='purple', lwd=3)
lines(days, self.mng, col='sienna', lwd=3)
lines(days, f1k / f1k[year.start], lwd=3, col='maroon')
lines(0:(length(sim1) - 1), sim1, lwd=3, col='hotpink')
lines(0:(length(sim2) - 1), sim2, lwd=3, col='limegreen')
lines(0:(length(sim3) - 1), sim3, lwd=3, col='cyan')
lines(0:(length(sim4) - 1), sim4, lwd=3, col='burlywood4')
lines(0:(length(sim5) - 1), sim5, lwd=3, col='coral')
lines(0:(length(extr) - 1), extr, lwd=2, col='green')
lines(days, (1 + tot - sp) / (1 + tot - sp)[year.start], col=2)
legend(
  'topleft',
  lty=1,
  lwd=c(3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1, 1),
  col=c(
    'orange', 'darkgreen', 'purple', 'sienna', 'maroon', 'cadetblue', 'black', 
    'hotpink', 'limegreen', 'cyan', 'burlywood4', 'coral', 'green', 'red'),
  legend=c(
    paste(sp.sh, 'S&P'),
    paste(fid.sh, 'Fid'),
    paste(et.sh, 'ETrade'),
    paste(self.mng.sh, 'Self-Managed'),
    paste(f1k.sh, '401(k) All'),
    paste(mine.sh, 'Mine'),
    paste(tot.sh, 'Total'),
    paste(sim1.sh, sim1.name),
    paste(sim2.sh, sim2.name),
    paste(sim3.sh, sim3.name),
    paste(sim4.sh, sim4.name),
    paste(sim5.sh, sim5.name),
    paste(extr.sh, 'extrema'),
    paste('Diff(SP)')),
  bg=rgb(1, 1, 1, alpha=0.8))
#--------------------------------------------------------------------------------


exp.mod <- function(funds, x) {
  savings.exp.mod <- lm(log(funds) ~ x)
  log.y <- coef(savings.exp.mod)[1] + x*coef(savings.exp.mod)[2]
  exp(log.y)  
}


start <- tot.val[prev.last]
now <- tot.val[length(tot.val)]
low <- min(tot.val[(prev.last):(length(tot.val))])
high <- max(tot.val[(prev.last):(length(tot.val))])


# PLOT 2: Total funds over time --------------------------------------------------
quartz()
x <- 1:length(tot.val)
plot(
  x, 
  tot.val, 
  type='l', 
  ylim=c(0, max(tot.val)), 
  main='1 = 01 Jan 2018')#, log='y')
lines(x, exp.mod(tot.val, x), col=rgb(0, 0, 0, 1))
abline(h=start, col='grey')
abline(h=now, col='grey')
abline(h=low, col=2)
abline(h=high, col=3)
old.f1k.val <- f1k.val
old.f1k.val[790:length(f1k.val)] <- 0
lines(fid.val + old.f1k.val, col=4)
lines(x, exp.mod(fid.val + old.f1k.val, x), col=rgb(0, 0, 1, 1))
lines(f1k.val[790:length(f1k.val)], col=5)
lines(
  x[790:length(f1k.val) - 789], 
  exp.mod(f1k.val[790:length(f1k.val)], x[790:length(f1k.val)]), 
  col=rgb(0, 1, 1, 1))
lines(et.val, col=6)
lines(x, exp.mod(et.val, x), col=rgb(1, 0, 1, 1))
smv <- self.mng.val[self.mng.val > 1]
x <- 1:length(smv)
lines(smv, col='sienna')
lines(x, exp.mod(smv, x), col='sienna')
legend(
  'topleft',
  lty=1,
  col=c('black', 'blue', 'magenta', 'cyan', 'sienna'),
  legend=c(
    paste('Total: ', tot.val[length(tot.val)]),
    'Fidelity', 
    'ETrade', 
    '401(k)', 
    'Self-Managed'),
  bg='white')
#--------------------------------------------------------------------------------


x <- 1:length(tot.val)
savings.exp.mod <- lm(log(tot.val) ~ x)
x <- prev.last + seq(250, 3750, by=250)[1:13]
log.y <- coef(savings.exp.mod)[1] + x*coef(savings.exp.mod)[2]
y <- round(exp(log.y))
for (p in y) { cat(p, '\n') }

(fid.amt <- fid.val[length(fid.val)])                # [179159 217844]
(et.amt <- et.val[length(et.val)])                   # [130010 154288]
(f1k.total <- f1k.val[length(f1k.val)])              # [ 18063  41548] 
(self.mng.amt <- self.mng.val[length(self.mng.val)]) # [  9514  16089]
(round(sim1.val) + (sim1.res))
(round(sim2.val) + (sim2.res))
(round(sim3.val) + (sim3.res))
(round(sim4.val) + (sim4.res))
(round(sim5.val) + (sim5.res))
(pct.invested)

n <- length(sim1)
NDAYS.LOOKBACK <- 8 * 5
sim1[n] / sim1[max(n - NDAYS.LOOKBACK, 1)]
sim2[n] / sim2[max(n - NDAYS.LOOKBACK, 1)]
sim3[n] / sim3[max(n - NDAYS.LOOKBACK, 1)]
sim4[n] / sim4[max(n - NDAYS.LOOKBACK, 1)]
sim5[n] / sim5[max(n - NDAYS.LOOKBACK, 1)]

n <- length(fid.val)
fid[n] / fid[n - NDAYS.LOOKBACK]
n <- length(et.val)
et[n] / et[n - NDAYS.LOOKBACK]
n <- length(self.mng.val)
self.mng[n] / self.mng[n - NDAYS.LOOKBACK]


# Perf:    1st 2nd 3rd  Pts(3x2x1)  : weeks 8
# sim1       7          21
# fid            4   6  14
# et                 1   1
# self.mng   1   4   1  12


#--------------------------------------------------------
# To Save New `df` at the end of each year:
#df.test <- data.frame(
#  sp.actual=sp.actual, fid.in=fid.in, fid.val=fid.val, f1k.in=f1k.in, 
#  f1k.val=f1k.val, et.in=et.in, et.val=et.val, self.mng.in=self.mng.in, 
#  self.mng.val=self.mng.val)
#matplot(df.test, type='l', lty=1, col=1:7)
#legend('topleft', lty=1, col=1:7, legend=names(df.test))
# Backed up previous?
#save(df.test, file='~/Learning/marketModeling/data/myHistoricTest.RData')
#rm(list=ls())
#load('~/Learning/marketModeling/data/myHistoricTest.RData')
#ls()
#matplot(df.test, type='l', lty=1, col=1:7)
#legend('topleft', lty=1, col=1:7, legend=names(df.test))
# OK?
#df <- df.test
#save(df, file='~/Learning/marketModeling/data/myHistoric.RData')
# Delete test and backups
