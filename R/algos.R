#---------#---------#---------#---------#---------#---------#---------#---------
load('~/Learning/marketModeling/data/myHistoric.RData')
head(df)
tail(df)

dailyChange <- function(x) {
  (x[2:length(x)] - x[1:(length(x) - 1)]) / x[1:(length(x) - 1)]
}

m <- dim(df)[1]
last <- m


wlsh.osc <- c(
  202,198,196,201,207,209,211,213,213,209,208,211,213,214,215,214,201,192,175,
  166,162,159,161,163,169,174,177,180,184,185,185,181,177,169,159,154,137,120,
  113,102, 84, 61, 45, 28, 19, 12, 12, 11, 13, 13, 13,  4, -3, -8,-19,-33,-44,
  -48,-54,-60,-64,-62,-55,-49,-45,-38,-30,-23,-16,-11, -2,  7, 12, 11, 15, 15,
   19, 25, 29, 32, 37, 36, 36, 31, 26, 22, 22, 15,  5,-15,-30,-36,-43,-53,-65,
  -71,-77,-78,-82,-83,-83,-84,-84,-84,-87,-85,-84,-82,-82,-80,-77,-75,-74,-76,
  -78,-87,-89,-88,-88,-85,-82,-78,-75,-72,-68,-62,-58,-54,-55,-50,-45,-44,-44,
  -47,-53,-66,-70,-70,-70,-65,-60,-59,-58,-55,-56,-58,-57,-59,-57,-55,-54,-53,
  -52,-50,-48,-47,-51,-59,-67,-71,-70,-67,-64,-65,-60,-51,-47,-42,-38,-37,-40,
  -47,-52,-61,-66,-70,-79,-95,-111,-121,-124,-127,-131,-145,-158,-175,-185,-202,
  -212,-220,-223,-226,-233,-239,-243,-239,-231,-223,-211,-199,-186)

SPActual <- c(df$SPActual,
    3701,  3727,  3748,  3804,  3825,  3800,  3801,  3810,  3796,  3768,  3799,
    3852,  3853,  3841,  3855,  3850,  3751,  3787,  3714,  3774,  3826,  3830,
    3872,  3887,  3916,  3911,  3910,  3916,  3935,  3933,  3931,  3914,  3907,
    3877,  3881,  3925,  3829,  3811,  3902,  3870,  3820,  3768,  3842,  3821,
    3875,  3899,  3939,  3943,  3969,  3963,  3974,  3915,  3913,  3941,  3911,
    3889,  3910,  3975,  3971,  3959,  3973,  4020,  4078,  4074,  4080,  4097,
    4129,  4128,  4142,  4125,  4170,  4185,  4163,  4135,  4173,  4135,  4180,
    4188,  4187,  4183,  4211,  4181,  4193,  4165,  4168,  4202,  4233,  4188,
    4152,  4063,  4113,  4174,  4163,  4128,  4116,  4159,  4156,  4197,  4188,
    4196,  4201,  4204,  4202,  4208,  4193,  4230,  4227,  4227,  4220,  4239,
    4247,  4255,  4247,  4224,  4222,  4166,  4225,  4246,  4242,  4266,  4281,
    4291,  4292,  4298,  4320,  4352,  4344,  4358,  4321,  4370,  4385,  4369,
    4374,  4360,  4327,  4258,  4323,  4359,  4367,  4412,  4422,  4401,  4401,
    4419,  4395,  4387,  4423,  4403,  4429,  4437,  4432,  4437,  4448,  4461,
    4468,  4480,  4448,  4400,  4406,  4442,  4480,  4486,  4496,  4470,  4509,
    4523,  4524,  4537,  4535,  4514,  4493,  4459,  4469,  4443,  4481,  4474,
    4433,  4358,  4354,  4396,  4449,  4455,  4443,  4353,  4359,  4308,  4357,
    4300,  4346,  4364,  4400,  4391,  4361,  4351,  4364,  4438,  4471,  4486,
    4520,  4536,  4550)
SP <- SPActual / SPActual[last]
SPd <- dailyChange(SP)

FidIn <- c(df$FidIn,
   53922, 53922, 53922, 53922, 53922, 53922, 53922, 53922, 53922, 53922, 54237,
   54237, 54237, 54237, 54237, 54237, 54237, 54237, 54237, 54237, 54374, 54374,
   54374, 54374, 54374, 54374, 54374, 54374, 54374, 54374, 54374, 54374, 54374,
   54374, 54374, 54374, 54374, 54374, 54686, 54686, 54686, 54686, 54686, 54686,
   54686, 54686, 54686, 54686, 55120, 55120, 55120, 55120, 55120, 55120, 55120,
   55120, 55120, 55120, 55120, 55120, 55120, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134, 57134,
   57134, 57134, 57134)
  
FidVal <- c(df$FidVal,
  100775,101806,100719,104282,106134,105570,107538,107355,107940,106940,109459,
  110997,110526,111271,111543,110262,107484,109536,108855,111502,113873,113818,
  115499,117322,117875,118172,117692,118556,119639,117678,115695,114613,116176,
  111259,109783,109466,104910,106892,110443,108295,103893,100791,100385, 97933,
  101389,101050,103550,102892,104611,103381,103419,100435,101666,102424,101883,
   98921, 98434, 98951, 97796, 98423,100298,105545,105223,106905,106282,107822,
  107772,107608,109458,108528,109640,107777,106413,105013,106624,106684,107668,
  109233,108900,108318,106900,105662,104119,102569,101520, 98999,100292, 97938,
   99562, 97231, 96192, 98256, 97922, 98484, 98465,100544,100172,101235,101235,
  102711,102831,103083,102590,102795,100900,101963,103374,103821,103530,104707,
  105446,106854,104991,105145,107587,108313,108203,109752,110781,112337,112586,
  114655,115227,114738,113886,113655,113854,112754,112029,113204,112428,111982,
  109998,109367,109150,109682,111719,112824,112964,114377,113367,111723,113815,
  113115,111155,111815,111618,112371,112921,111060,111938,110598,110973,111430,
  110745,109427,109103,108323,107464,108693,110190,111948,112459,112055,112542,
  112180,113632,113336,113576,111785,112347,111865,111055,110272,110593,111092,
  111560,109341,109730,110508,111222,110470,109765,106908,105732,106308,106764,
  103741,104606,105494,107017,106249,105528,106115,107797,108955,108896,109862,
  110947,110808,112199) #
Fid <- FidVal / FidIn
Fid <- Fid / Fid[last]
Fidd <- dailyChange(Fid)

f1kIn <- c(df$f1kIn,
   81977, 81977, 81977, 81977, 81977, 81977, 81977, 81977, 81977, 81977, 81977,
   82670, 82670, 82670, 82670, 82670, 82670, 82670, 82670, 82670, 83373, 83373,
   83373, 83373, 83373, 83373, 83373, 83373, 83373, 84026, 84026, 84026, 84026,
   84026, 84026, 84026, 84026, 84026, 84754, 84754, 84754, 84754, 84754, 84754,
   84754, 84754, 84754, 84754, 84754, 85475, 85475, 85475, 85475, 85475, 85475,
   85475, 85475, 85475, 85475, 85475, 85475, 86214, 86214, 86214, 86214, 86214,
   86214, 86214, 86214, 86214, 86214, 86929, 86929, 86929, 86929, 86929, 86929,
   86929, 86929, 86929, 86929, 86929, 86929, 87634, 87634, 87634, 87634, 87634,
   87634, 87634, 87634, 88364, 88364, 88364, 88364, 88364, 88364, 88364, 88364,
   88364, 88364, 88364, 89079, 89079, 89079, 89079, 89079, 89079, 89079, 89079,
   89079, 89079, 89079, 89789, 89789, 89789, 89789, 89789, 89789, 89789, 89789,
   89789, 89789, 90495, 90495, 90495, 90495, 90495, 90495, 90495, 90495, 90495,
   90495, 90495, 91204, 91204, 91204, 91204, 91204, 91204, 91204, 91204, 91204,
   91204, 91204, 91903, 91903, 91903, 91903, 91903, 91903, 91903, 91903, 91903,
   91903, 92593, 92593, 92593, 92593, 92593, 92593, 92593, 92593, 92593, 92593,
   93285, 93285, 93285, 93285, 93285, 93285, 93285, 93285, 93285, 93978, 93978,
   93978, 93978, 93978, 93978, 93978, 93978, 93978, 93978, 93978, 93978, 93978,
   94678, 94678, 94678, 94678, 94678, 94678, 94678, 94678, 94678, 94678, 95368,
   95368, 95368, 95368) #
f1kVal <- c(df$f1kVal,
  117777,116744,117728,117731,120057,121168,120278,120935,120334,120334,120554,
  121979,123642,123696,123631,123631,122528,118811,120519,119737,122325,124491,
  123724,125251,126357,127527,127656,127631,128367,130090,128945,128945,128166,
  128674,126348,126059,126840,123391,125056,127839,126344,123241,120600,121952,
  120098,123207,123199,125720,125586,127255,127019,127019,124933,125398,125724,
  122721,122721,123290,124469,123297,123677,125808,125808,127974,127974,127519,
  128428,128743,128549,128853,128815,130977,130105,130105,128440,129968,128929,
  130954,131643,131678,131899,131900,131727,131936,130893,130893,131328,132546,
  130523,127212,128260,131152,131152,131062,129712,130546,130623,130623,131498,
  130964,131783,132143,133927,133629,133117,133728,133728,134049,134330,133827,
  133788,134324,134133,135073,134071,134072,132912,134418,135166,136019,136019,
  135863,135993,137122,137346,137599,137602,136866,136633,137330,137754,137754,
  136389,136389,137107,136041,134582,136582,137927,137532,138660,138984,138213,
  138816,139344,139871,139474,140518,140820,140820,141500,141110,141455,142301,
  142287,142926,142494,140990,139899,139125,140569,142373,144038,144038,142932,
  146142,146142,146551,146551,145349,145349,145013,144265,143827,146023,145828,
  145828,144829,142661,142678,145490,145490,145551,145987,143594,143520,143400,
  144835,143452,144586,145654,145654,145283,144466,144867,144867,146606,148732,
  148732,149213,149555) #
payment <- 1018.67
n <- length(f1kIn)
payment * f1kIn[n] / f1kVal[n] + f1kIn[n]

f1k <- f1kVal / f1kIn
f1k <- f1k / f1k[last]
f1kd <- dailyChange(f1k)

OHIn <- c(df$OHIn,
   46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021,
   46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021,
   46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021,
   46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021,
   46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 46021, 39307, 39307,
   39307, 39307, 39307, 39307, 39307, 39307, 39443, 39443, 39443, 39443, 39443,
   39443, 39443, 39443, 39443, 39443, 39694, 39694, 39694, 39694, 39694, 39694,
   39694, 39694, 39694, 39694, 39694, 39936, 39936, 39936, 39936, 39936, 39936,
   39936, 39936, 40200, 40200, 40531, 40531, 40531, 40531, 40531, 40531, 40531,
   40531, 40531, 40881, 40881, 40881, 40881, 40881, 40881, 40881, 40881, 40881,
   40881, 40881, 40881, 41225, 41225, 41225, 41225, 41225, 41225, 41225, 41225,
   41225, 41225, 41225, 41554, 41554, 41554, 41554, 41554, 41554, 41554, 41554,
   41554, 41881, 41881, 41881, 41881, 41881, 41881, 41881, 41881, 41881, 41881,
   41881, 42208, 42208, 42208, 42208, 42208, 42208, 42208, 42208, 42208, 42208,
   42552, 42552, 42552, 42552, 42552, 42552, 42552, 42552, 42552, 42552, 42552,
   42552, 42874, 42874, 42874, 42874, 42874, 42874, 42874, 42874, 42874, 43474,
   43474, 43474, 43828, 43828, 43828, 43828, 43828, 43828, 43828, 43828, 44409,
   44409, 44409, 44409, 44409, 44409, 44409, 44409, 44409, 44409, 44960, 44960,
   44960, 44960, 44960) #
OHVal <- c(df$OHVal, 
   99561,100876, 99287,103014,104849,104471,107010,107093,107445,106404,108339,
  109868,109448,110351,110633,109193,106228,107902,107523,109218,111376,111362,
  112837,114507,115070,115961,115690,116960,117369,116242,114644,113656,115007,
  110730,109404,109333,105306,107034,109264,107765,103819,101054,100806, 99134,
  101622,101246,103242,102694,103325,102648,102961,100355,101452, 87037, 86693,
   84611, 84231, 84590, 83743, 84206, 85650, 87094, 87041, 88052, 87532, 88805,
   88826, 89042, 90562, 89641, 90900, 90612, 89286, 88477, 89308, 89204, 90453,
   91960, 91652, 91518, 90168, 88880, 87832, 86221, 85114, 82896, 84726, 82617,
   83738, 82515, 81775, 83143, 83630, 84050, 84053, 85876, 85262, 85957, 86149,
   87060, 87227, 88219, 87824, 87963, 86472, 87322, 88436, 88765, 88638, 89436,
   89911, 90798, 89601, 89870, 92060, 92609, 92486, 93600, 94295, 95402, 95659,
   96973, 97244, 96882, 96997, 96828, 96908, 96155, 95585, 96308, 95830, 95581,
   94176, 94520, 94462, 94876, 95998, 96643, 96811, 97876, 96900, 95736, 97539,
   96802, 96111, 96316, 95859, 96304, 96559, 95474, 96069, 95251, 94943, 95205,
   95372, 94478, 94345, 93929, 93370, 94240, 95352, 96741, 97020, 96585, 97109,
   96806, 98546, 98505, 99118, 97763, 98736, 98238, 97256, 97174, 97692, 99846,
  100251, 98751,100042,100617,100976,100558,100098, 98235, 97570, 98119, 99525,
   97796, 98333, 98859, 99830, 99403, 98980, 99465,100560,100942,102256,103205,
  104997,105043,106099) #
OH <- OHVal / OHIn
OH <- OH / OH[last]
OHd <- dailyChange(OH)
totalFunds <- FidVal + f1kVal + OHVal


# Actual-Stratego 
m1 <- (c(
  100000, 97573, 99368, 97344,102160,104572,104303,107511,107529,107726,106392,
  108987,110861,110273,111413,111413,107686,103945,106512,105521,108375,111209,
  111242,113331,115778,116661,117908,117253,118611,119394,118349,116172,115151,
  117336,110919,108642,108221,101922,104631,106850,105531, 98774, 94278, 93620,
   89596, 95521, 94567, 99464, 98224, 99462, 98211, 98299, 93394, 95287, 96724,
   95632, 90890, 90136, 90963, 89031, 90012, 92921, 95563, 94804, 97205, 96249,
   99093, 99263, 99461,102175,100359,102524,100728, 98299, 96499, 97955, 97635,
   99445,101557,101175,100755, 98934, 97247, 94660, 92309, 90825, 86991, 89296,
   85938, 87621, 84396, 83089, 85864, 85184, 85641, 85658, 87213, 87167, 87968,
   88133, 89063, 89234, 89379, 88908, 88987, 87999, 89498, 90228, 90561, 90437,
   91512, 92425, 93229, 91846, 92090, 91871, 92167, 94523, 95550, 95770, 96989,
   97078, 98109, 98347, 97469, 96946, 96940, 97630, 96852, 96307, 96997, 96508,
   96267, 94563, 93958, 93823, 94186, 95967, 96646, 96988, 98368, 97468, 96486,
   97271, 96977, 96330, 96820, 96124, 96868, 97989, 96553, 97135, 96009, 96150,
   96611, 96350, 95163, 94898, 94640, 93577, 94440, 95993, 97680, 97875, 97120,
   98093, 98299, 99140, 99848,101014, 99445, 99682, 99038, 97995, 97643, 98210,
   99199, 99580, 97763, 98533, 99415,100151, 99769, 98792, 95199, 94288, 94785,
   94989, 95132, 92906, 93639, 95246, 94577, 94163, 94708, 96423, 97258, 97340,
   98262, 99509, 99389,100557)
  / 100000)
qp.start <- 92
m1.name <- 'BuyNHold'
  
# Nug2021 (actual)
m2 <- (c(
  100000, 97571, 99367, 97325,102154,104574,104162,107106,107325,107519,106447,
  108792,110831,110256,111484,111420,109139,105790,108364,107381,110151,113367,
  113334,115738,118125,118974,120009,119433,121103,121666,120001,117765,116816,
  118627,112556,110721,110641,104571,106850,110682,107334,100703, 95943, 95136,
   91019, 97128, 96284,101381, 99949,101442, 99859,100041, 95224, 97342, 98745,
   97643, 92530, 91641, 92551, 90620, 91709, 94903, 97590, 96998, 99279, 98182,
  101005,101035,101109,103532,102062,103865,102277,100076, 98193, 99834, 99686,
  101767,103997,103709,103182,101141, 99340, 96811, 94493, 92931, 89492, 91370,
   85938, 89987, 86595, 85053, 88241, 87825, 88785, 88814, 91728, 91133, 92532,
   92843, 94430, 94644, 95034, 94449, 94725, 92004, 93856, 95517, 96166, 95824,
   97190, 97977, 99757, 97579, 97778, 98052, 98987,101811,103625,104726,106536,
  107042,109327,109750,109085,108087,107800,108262,106892,105908,107218,106312,
  105758,103146,102388,102261,103061,105478,106772,107046,108855,107629,106008,
  108101,107192,105148,105701,105297,106108,106936,104858,105699,104441,104561,
  105172,104471,102917,102628,101697,100871,102314,104037,106176,106772,106182,
  106966,106520,108051,107668,108095,105836,106558,105886,104876,103839,104417,
  105412,106112,103465,103717,104424,104798,104260,104439,100635, 99028,100129,
  100392, 97160, 97512, 97737, 98723, 98693, 97744, 98156,100096,101038,100557,
  100681,102309,102611,103440)
  / 100000) 
m2.name <- 'Ideal (Nug2021)' # when up -> Cash in low; when down: even balance

# buy-lowball 
# Weekly: 20% from each of the top 3 to the bottom 3
# Top 3 to bottom 3
m3.raw <- c(
  100000, 97712, 99493, 97488,102309,104673,104338,107501,107577,107851,106448,
  108994,110922,110438,111685,111678,108828,105126,107645,106697,109456,112506,
  112449,114619,117096,118002,119308,118543,120265,121028,119900,117723,116771,
  118782,112309,110228,109876,103755,106481,110395,107175,100458, 96088, 95589,
   91908, 97826, 96850,101630,100189,101468,100212,100335, 95297, 97287, 98863,
   97873, 93262, 92433, 93173, 91066, 91893, 94954, 97518, 96961, 99007, 97853,
  100445,100434,100861,103783,102170,104265,102353, 99812, 98146, 99764, 99675,
  101165,103740,103193,102634,100459, 99043, 96480, 93979, 92666, 89398, 91632,
   87835, 89926, 86949, 85223, 88073, 87336, 88406, 88261, 91166, 90658, 92046,
   92339, 94255, 94367, 94643, 93826, 94075, 91585, 92654, 94781, 95616, 95273,
   96714, 97565, 99400, 96860, 97216, 95817, 96543,100920,102725,103828,105867,
  106606,108870,109482,108981,107739,107308,107691,105997,105285,106644,105396,
  104655,102053,101165,101278,102426,104708,105833,106397,108296,106760,104945,
  107063,106020,104252,104268,104076,104583,105992,103781,104852,103772,103452,
  103736,102384,100637,100474, 99659, 98490,100130,102160,104335,104935,104457,
  105487,105340,107042,107443,107928,105601,105803,105309,104110,103129,103513,
  104229,105445,102390,102525,103562,104492,103430,102844, 99070, 97237, 98180,
   98179, 94238, 95364, 96441, 98518, 97377, 96142, 97172, 99288,100439,100166,
  100929,102629,103292,104157)
m3 <- m3.raw / 100000
m3.name <- 'CashInLow'
#len <- length(m3)
#(last.week.gains <- m3.raw[len] - m3.raw[len - 7])
#(per <- last.week.gains / 3)

# buy-highball
# Weekly: 20% from each of the bottom 3 to the top 3
# Bottom 3 to top 3
m4.raw <- c(
  100000, 97671, 99458, 97401,102290,104670,104323,107402,107403,107416,106014,
  108674,110578,110035,111144,111313,107662,103882,106295,105412,108130,110785,
  110876,112882,115455,116323,117607,117014,118612,119406,118295,116177,115030,
  117039,110632,108534,108166,101915,104560,108682,105631, 98890, 94259, 93589,
   89422, 95160, 94351, 99197, 98034, 99237, 97990, 97975, 93224, 95098, 96383,
   95257, 90614, 89940, 90889, 89058, 90090, 92924, 95628, 94949, 97379, 96423,
   99224, 99445, 99579,102102,100347,102514,100835, 98601, 96772, 98215, 97999,
   99886,101809,101472,100901, 99378, 97640, 95233, 92807, 91358, 87567, 89822,
   86754, 88149, 84779, 83689, 86471, 85928, 86772, 86644, 89309, 88736, 89963,
   90145, 91012, 91026, 91244, 90699, 90538, 88676, 90008, 91447, 92136, 91754,
   92975, 93670, 95118, 93345, 93542, 93627, 94420, 97047, 98636, 99325,100331,
  100601,102336,102610,101743,100431,100413,101600,100537, 99619,100771,100171,
   99393, 97014, 96219, 96086, 96851, 99003,100062,100709,103430,102380,100815,
  102095,101168, 99047, 99236, 99148,100697,101348, 99578, 99962, 98588, 98143,
   98914, 98308, 97095, 96945, 96388, 96266, 97333, 98610,100212,100719,100162,
  101283,101490,102260,102439,104144,101691,101668,100958,100068,100137,100906,
  102214,102471,100271,101051,102292,104492,102877,100966, 96929, 96076, 96778,
   96845,100341, 94596, 95717, 97265, 95871, 94944, 95577, 97852, 98866, 99220,
  100388,101091,101426,102517)
m4 <- m4.raw / 100000
m4.name <- 'CashInHigh'
len <- length(m4)
(last.week.gains <- m4.raw[len] - m4.raw[len - 7])
(per <- last.week.gains / 3)
  
# 30/70 
# Whenever a stock moves above 70, take out 20% to reserve
# Whenever a stock falls below 30 add 10% of reserves 
# (or whatever fraction if > 4)
m5 <- (c(
  100000, 97738, 99501, 97535,102285,104624,104400,107473,107542,107573,106249,
  108679,110549,110105,111212,111309,108494,105085,107334,106608,108936,111588,
  111659,113560,115826,116578,117670,117018,118445,119126,118142,116229,115322,
  117209,111542,109753,109497,104072,106548,110232,107514,101300, 97189, 96600,
   92523, 98668, 97430,102655,101196,102557,101293,101376, 96342, 98483, 99357,
   99076, 93960, 93045, 93951, 91929, 92860, 96009, 98772, 97827,100188, 98981,
  101860,101915,102244,105898,104108,106308,104317,101684, 99957,101404,101333,
  103144,105419,105011,104243,102287,100635, 97849, 95417, 93884, 89730, 92105,
   88915, 90830, 87571, 86124, 89145, 88408, 89526, 89502, 92519, 92003, 93326,
   93616, 95221, 95323, 95454, 94630, 94842, 92428, 93530, 95659, 96598, 96127,
   97430, 98306,100035, 97804, 98123, 97627, 98389,101616,103610,104598,106285,
  106723,108987,109407,108546,107090,106711,107290,105885,105517,106285,105437,
  104613,102240,101421,101552,102772,104799,105822,106254,108002,106883,105419,
  106989,105936,103692,103841,103520,104474,104989,102845,103584,102593,102578,
  103018,102154,100505,100530, 99789, 99008,100488,102225,104291,104778,104670,
  105363,105457,106680,107205,108625,106709,107124,106896,105661,104937,105348,
  106162,107069,104362,104519,105304,105942,105247,104905,101555,100213,100997,
  101107, 97628, 98748, 99859,101812,100670, 99504,100551,102251,103210,103165,
  103753,105467,106218,107606)
  / 100000)
m5.name <- '30/70'  


m6 <- (c(
  100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,
  100000,100000,100000,100000,100000,100000,100000,100000,100000,100039,100061,
  100456,101872,103664,104319,104605,104362,104698,104954,103219,101540,100857,
  102589, 98833, 98671, 98425, 94655, 95673, 96701, 96698, 96682, 96674, 96684,
   96685, 96697, 96702, 96708, 96708, 96718, 96712, 96707, 96691, 96690, 96687,
   96682, 96682, 96688, 96693, 96296, 95328, 96348, 97386, 98030, 98029, 98009,
   98138, 98260, 99153,101256, 99424,101820,100008, 97867, 96671, 97724, 97539,
   98858,100537,100197, 99992, 98022, 96837, 95064, 92529, 91829, 88989, 90672,
   88732, 89022, 87537, 87190, 88100, 86900, 87315, 87133, 88650, 88171, 88606,
   88495, 90782, 90313, 90375, 89937, 90003, 88585, 89913, 91512, 92156, 91902,
   93374, 94331, 95935, 93848, 94285, 94097, 95050, 98092, 99988,101308,103159,
  103654,105851,106145,105338,104049,103899,104307,102843,101821,103158,102019,
  101278, 98801, 98010, 97863, 99048,101308,101525,102425,103417,102054,100911,
  102649,102062,100163,100630,100571,101452,103568,102077,102279,101705,103579,
  104387,105285,103868,103537,103536,102871,103996,105070,106707,107327,107392,
  108285,109107,109680,110727,111329,110030,110023,109432,108931,107900,108113,
  108929,109720,107564,108570,109675,110538,109903,109359,105500,104194,105134,
  105377,100788,101503,102354,104140,102784,102156,102865,103949,104528,104362,
  105194,106771,106583,107495)
  / 100000)
m6.name <- 'rsi each'  

m7 <- (c(
  100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,100000,
  100000,100000,100000,100000,100000,100000,100000,100000,100000,100396,101084,
  101156,101669,102140,102243,102939,102629,103844,104154,103338,101998,101447,
  102663, 99844, 99141, 99059, 96672, 97645, 98587, 98532, 98508, 98443, 98437,
   98364, 98470, 97449, 98546, 98541, 98546, 98529, 98522, 98394, 98462, 98474,
   98464, 98370, 98390, 98406, 98380, 98410, 98394, 98500, 97993, 98750, 98434,
   99343, 99392, 99696,101501,100210,101701,100440, 98863, 97496, 98685, 98666,
  100199,101844,101554,101112, 99668, 98235, 96408, 94499, 93300, 90796, 92302,
   90406, 91001, 89893, 89336, 90399, 90210, 90454, 90457, 91235, 91100, 91602,
   91716, 92267, 92315, 92440, 91788, 91843, 89947, 91103, 92435, 92916, 92640,
   93742, 94538, 95871, 94232, 94394, 94499, 95294, 97430, 98888, 99862,101191,
  101495,103226,103557,103000,102029,102020,102376,101312,100602,101602,100898,
  100435, 98451, 97890, 97777, 98504,100324,101017,101209,102212,101241,100129,
  101713,101119, 99593,100166, 99788,100408,101420,100124,100603, 99810, 99939,
  100305, 99918, 98989, 98820, 98551, 98218, 98856, 99645,100614,100871,100609,
  100999,100935,101636,101615,102230,100958,101478,101015,100369, 99948,100405,
  101184,101512, 99705,100438,101146,101832,101286,100625, 97889, 96975, 97630,
   97741, 96054, 95547, 96477, 97787, 97068, 96576, 97035, 99354,100163, 99925,
  100773,103224,103060,103862)
  / 100000)
m7.name <- 'rsi overall'  


totin <- FidIn + f1kIn + OHIn
totval <- FidVal + f1kVal + OHVal
tot <- totval / totin 
tot <- tot / tot[last]
minein <- FidIn + OHIn
mineval <- FidVal + OHVal
mine <- mineval / minein
mine <- mine / mine[last]
m1 <- m1 / m1[1]
m2 <- m2 / m2[1]
m3 <- m3 / m3[1]
m4 <- m4 / m4[1]
m5 <- m5 / m5[1]
m6 <- m6 / m6[1]
m7 <- m7 / m7[1]

# Calculate Sharpe Ratios
Sharpe <- function(returns, window=length(returns)) {
  if (length(returns) > window) {
    returns <- returns[(length(returns) - window):length(returns)]	  	
  }	
  returns <- returns[!is.na(returns)]
  (sqrt(252) * mean(returns)) / sd(returns)
}

get.daily.returns <- function(x) { 
  n <- length(x)
  x[2:n] / x[1:(n - 1)] - 1 
}

n <- length(m1) 
m <- length(SP)
this.year <- (m-n):m

SP.sh  <- round(Sharpe(get.daily.returns(SP[this.year])), 3)
tot.sh <- round(Sharpe(get.daily.returns(tot[this.year])), 3)
mine.sh <- round(Sharpe(get.daily.returns(mine[this.year])), 3)
m1.sh  <- round(Sharpe(get.daily.returns(m1)), 3)
m2.sh  <- round(Sharpe(get.daily.returns(m2)), 3)
m3.sh  <- round(Sharpe(get.daily.returns(m3)), 3)
m4.sh  <- round(Sharpe(get.daily.returns(m4)), 3)
m5.sh  <- round(Sharpe(get.daily.returns(m5)), 3)
m6.sh  <- round(Sharpe(get.daily.returns(m6)), 3)
m7.sh  <- round(Sharpe(get.daily.returns(m7)), 3)
prev <- m - n
days <- -prev:(n - 1)
new.days <- 0:(n - 1)
plot(new.days,
     m1, 
     type='l', 
     xlim=range(days),
     ylim=range(c(SP,  tot, 1 + tot - SP, mine, m1,  m2, m3, m4, m5, m6, m7)), 
     lwd=3, 
     log='y')
abline(h=seq(0, 8, 0.1), lty=2, col=rgb(0, 0, 0, 0.2))
abline(h=seq(0, 8, 0.5), lty=4, col=rgb(0, 0, 0, 0.8))
abline(v=0, lwd=2)
lines(days, tot, col=2, lwd=3)
lines(days, mine, col='cadetblue', lwd=3)
lines(days, SP, col='yellow', lwd=3)
lines(new.days, m2, lwd=3, col='coral')
lines(new.days, m3, lwd=3, col='blue')
lines(new.days, m4, lwd=3, col='purple')
lines(new.days, m5, lwd=3, col='cyan')
lines(new.days, m6 + 0.07, lwd=3, col='grey')
lines(new.days, m7 + 0.07, lwd=3, col='magenta')
lines(days, 1 + tot - SP, col='#880000')
legend(
  'topleft', 
  lty=1, 
  lwd=c(3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1), 
  col=c('black', 'red ', 'cadetblue', 'yellow',  'coral', 'blue', 'purple', 
        'cyan', 'grey', 'magenta', '#880000'),
  legend=c(paste(m1.sh, m1.name), 
           paste(tot.sh, 'Actual'), 
           paste(mine.sh, 'Mine'),
           paste(SP.sh, 'S&P'), 
           paste(m2.sh, m2.name), 
           paste(m3.sh, m3.name), 
           paste(m4.sh, m4.name), 
           paste(m5.sh, m5.name), 
           paste(m6.sh, m6.name), 
           paste(m7.sh, m7.name), 
           'Actual Diff'),
  bty='n')
abline(v=qp.start)
  
quartz()  
plot(new.days,
     m1, 
     type='l', 
     xlim=range(days[days >= 0]),
     ylim=c(0.8,
            max(c(SP,  tot, 1 + tot - SP, mine, m1,  m2, m3, m4, m5, m6, m7))), 
     lwd=3, 
     log='y')
abline(h=seq(0, 8, 0.1), lty=2, col=rgb(0, 0, 0, 0.2))
abline(h=seq(0, 8, 0.5), lty=4, col=rgb(0, 0, 0, 0.8))
abline(v=0, lwd=2)
lines(days, tot, col=2, lwd=3)
lines(days, mine, col='cadetblue', lwd=3)
lines(days, SP, col='yellow', lwd=3)
lines(new.days, m2, lwd=3, col='coral')
lines(new.days, m3, lwd=3, col='blue')
lines(new.days, m4, lwd=3, col='purple')
lines(new.days, m5, lwd=3, col='cyan')
lines(new.days, m6 + 0.07, lwd=3, col='grey')
lines(new.days, m7 + 0.07, lwd=3, col='magenta')
lines(days, 1 + tot - SP, col='#880000')
legend(
  'topleft', 
  lty=1, 
  lwd=c(3, 3, 3, 3, 3, 3, 3, 3, 3, 3, 1), 
  col=c('black', 'red ', 'cadetblue', 'yellow',  'coral', 'blue', 'purple', 
        'cyan', 'grey', 'magenta', '#880000'),
  legend=c(paste(m1.sh, m1.name), 
           paste(tot.sh, 'Actual'), 
           paste(mine.sh, 'Mine'),
           paste(SP.sh, 'S&P'), 
           paste(m2.sh, m2.name), 
           paste(m3.sh, m3.name), 
           paste(m4.sh, m4.name), 
           paste(m5.sh, m5.name), 
           paste(m6.sh, m6.name), 
           paste(m7.sh, m7.name), 
           'Actual Diff'),
  bty='n')
abline(v=qp.start)
  
# Downward vals only
sp.start <- which(SP == 1)
n.sp <- length(SP)
sp.rec <- SP[sp.start:n.sp]
n.sp <- length(sp.rec)
sp.ch <- sp.rec[2:n.sp] / sp.rec[1:(n.sp-1)]
m1.ch <- m1[2:n.sp] / m1[1:(n.sp-1)]
m2.ch <- m2[2:n.sp] / m2[1:(n.sp-1)]
m3.ch <- m3[2:n.sp] / m3[1:(n.sp-1)]
m4.ch <- m4[2:n.sp] / m4[1:(n.sp-1)]
m5.ch <- m5[2:n.sp] / m5[1:(n.sp-1)]
m6.ch <- m6[2:n.sp] / m6[1:(n.sp-1)]
m7.ch <- m7[2:n.sp] / m7[1:(n.sp-1)]
down.days <- which(sp.ch <= 1)
up.days <- which(sp.ch > 1)
quartz()
plot(cumprod(c(1, sp.ch[down.days])), 
     type='l', 
     col='yellow', 
     ylim=range(cumprod(c(1, m1.ch[down.days])), 
                cumprod(c(1, m2.ch[down.days])), 
                cumprod(c(1, m3.ch[down.days])), 
                cumprod(c(1, m4.ch[down.days])), 
                cumprod(c(1, m5.ch[down.days])), 
                cumprod(c(1, m6.ch[down.days])), 
                cumprod(c(1, m7.ch[down.days]))), 
     log='y',
     lwd=2,
     main='Downward Days Only',
     ylab='Change')
lines(cumprod(c(1, m1.ch[down.days])), col='black', lwd=2)  
lines(cumprod(c(1, m2.ch[down.days])), col='coral', lwd=2)  
lines(cumprod(c(1, m3.ch[down.days])), col='blue', lwd=2)  
lines(cumprod(c(1, m4.ch[down.days])), col='purple', lwd=2)  
lines(cumprod(c(1, m5.ch[down.days])), col='cyan', lwd=2)  
lines(cumprod(c(1, m6.ch[down.days])) - 0.09, col='grey', lwd=2)  
lines(cumprod(c(1, m7.ch[down.days])) - 0.09, col='magenta', lwd=2)  
legend('topright', 
       lty=1,
       lwd=2, 
       col=c('yellow', 'black', 'coral', 'blue', 'purple', 'cyan', 'grey', 
             'magenta'),
       legend=c('SP', m1.name, m2.name, m3.name, m4.name, m5.name, m6.name, 
                m7.name))
quartz()
plot(cumprod(c(1, sp.ch[up.days])), 
     type='l', 
     col='yellow', 
     ylim=range(cumprod(c(1, m1.ch[up.days])), 
                cumprod(c(1, m2.ch[up.days])), 
                cumprod(c(1, m3.ch[up.days])), 
                cumprod(c(1, m4.ch[up.days])), 
                cumprod(c(1, m5.ch[up.days])), 
                cumprod(c(1, m6.ch[up.days])), 
                cumprod(c(1, m7.ch[up.days]))), 

     log='y',
     lwd=2,
     main='Upward Days Only',
     ylab='Change')
lines(cumprod(c(1, m1.ch[up.days])), col='black', lwd=2)  
lines(cumprod(c(1, m2.ch[up.days])), col='coral', lwd=2)  
lines(cumprod(c(1, m3.ch[up.days])), col='blue', lwd=2)  
lines(cumprod(c(1, m4.ch[up.days])), col='purple', lwd=2)  
lines(cumprod(c(1, m5.ch[up.days])), col='cyan', lwd=2)  
lines(cumprod(c(1, m6.ch[up.days])) + 0.17, col='grey', lwd=2)  
lines(cumprod(c(1, m7.ch[up.days])) + 0.17, col='magenta', lwd=2)  
legend('topleft', 
       lty=1,
       lwd=2, 
       col=c('yellow', 'black', 'coral', 'blue', 'purple', 'cyan', 'grey', 
             'magenta'),
       legend=c('SP', m1.name, m2.name, m3.name, m4.name, m5.name, m6.name, 
                m7.name))

#______________________________________________________________________________


quartz()
x <- 1:length(totalFunds)
plot(x, 
     totalFunds, 
     type = 'l', 
     ylim=c(0, max(totalFunds)), 
     main='1 = 01 Jan 2018')#, log='y')
#savings.mod <- lm(totalFunds ~ x)

exp.mod <- function(funds, x) {
  savings.exp.mod <- lm(log(funds) ~ x)
  log.y <- coef(savings.exp.mod)[1] + x*coef(savings.exp.mod)[2]
  exp(log.y)  
}


#abline(savings.mod, col=rgb(0, 0, 0, 0.25))
start <- totalFunds[last]
now <- totalFunds[length(totalFunds)]
low <- min(totalFunds[(last):(length(totalFunds))])
high <- max(totalFunds[(last):(length(totalFunds))])
earned <- high - start
down.from.high <- high - now
amt.down <- round(-100 *  down.from.high / earned, 2)
lines(x, exp.mod(totalFunds, x), col=rgb(0, 0, 0, 1))
abline(h=start, col='grey')
abline(h=now, col='grey')
abline(h=low, col=2)
abline(h=high, col=3)

lines(FidVal, col=4)
lines(x, exp.mod(FidVal, x), col=rgb(0, 0, 1, 1))

lines(f1kVal, col=5)
lines(x, exp.mod(f1kVal, x), col=rgb(0, 1, 1, 1))

lines(OHVal, col=6)
lines(x, exp.mod(OHVal, x), col=rgb(1, 0, 1, 1))

# FIX HERE
#amt.down <- round(100 * pct, 2)
amt.up <- round(100 * ((totalFunds[length(totalFunds)] / start) - 1), 2)
legend(
  'topleft', 
  text.col=c('green', 'black', 'red'), 
  legend=c(sprintf('$%d', max(totalFunds)),
  sprintf('$%d\n(%.2f%% down\n  %.2f%% up)',
          totalFunds[length(totalFunds)],
          amt.down,
          amt.up),
          sprintf('$%d', low)), 
  bg=rgb(1, 1, 1, 0.75))
legend('bottomright',
       lty=1,
       col=c(4, 5, 6, 1),
       legend=c('Fidelity', '401(k)', 'E*Trade', 'Total'),
       bg=rgb(1, 1, 1, 0.75))

day <- length(f1kIn) - 1 # length(<some new algo>) - 1
# Pad with leading NAs to make all vectors of equal length
tLength <- length(SP)
#Fid     <- c(rep(NA, tLength - length(Fid)),     Fid)
#OH      <- c(rep(NA, tLength - length(OH)),      OH)
#f1k     <- c(rep(NA, tLength - length(f1k)),     f1k)
days <- seq(to=day, by=1, length=tLength)

d <- data.frame(SP, Fid, OH, f1k)
realWts <- matrix(data=c(FidVal, OHVal, f1kVal), ncol=3)
realWts <- realWts / rowSums(realWts, na.rm = T)
realWts[is.na(realWts)] <- 0 
nWts <- length(realWts[, 1])
meanReal <- (Fid[(length(Fid) - nWts + 1):length(Fid)] * realWts[, 1] +
             OH[(length(OH)   - nWts + 1):length(OH)]  * realWts[, 2] +
             f1k[(length(OH)  - nWts + 1):length(f1k)] * realWts[, 3])
#meanReal <- c(rep(NA, 249), meanReal)
colors <- c(SP='yellow', Fid='red', OH='green', f1k='#cc0088', meanReal='grey')			   
quartz()
matplot(days, d, type = 'l', lty = 1, col = colors, 
		lwd = 2, main = 'Performance of Funds (2018)',
	  	xlab = 'Market Days Elapsed', ylab = 'Times Original Value', 
	  	log = 'y', 
	  	xlim = c(0, day + 5), 
	  	ylim = c(min(d[days >= 0, ], meanReal - SP + 1, na.rm=T), 
	  			 max(d[days >= 0, ], meanReal - SP + 1, na.rm=T)))
lines(days, (meanReal - SP) + 1, lwd=1)
lines(days, d[, 'SP'], col = 'yellow', lwd=3)
lines(days, meanReal, col = colors['meanReal'], lwd=1)

abline(h=1, lwd = 2)
abline(v=0, lwd = 2)
abline(v=last - 1)
#abline(v=c(30, 75), lty=4, col=rgb(0, 0, 0, 0.4))
abline(h=seq(0.1, 5.0, 0.1), col=rgb(0, 0, 0, 0.4), lty=2:1)

SP.Sharpe   <- round(Sharpe(SPd),  3)
Fid.Sharpe  <- round(Sharpe(Fidd), 3)
OH.Sharpe   <- round(Sharpe(OHd),  3)
f1k.Sharpe  <- round(Sharpe(f1kd), 3)
real.Sharpe <- round(Sharpe(dailyChange(meanReal)), 3)   

all.n <- length(SPd)
SP.Sharpe1yr   <- round(Sharpe(SPd[last:all.n],  250), 3)
Fid.Sharpe1yr  <- round(Sharpe(Fidd[last:all.n], 250), 3)
OH.Sharpe1yr   <- round(Sharpe(OHd[last:all.n],  250), 3)
f1k.Sharpe1yr  <- round(Sharpe(f1kd[last:all.n], 250), 3)
real.Sharpe1yr <- round(Sharpe(dailyChange(meanReal)[last:all.n], 250), 3)

legend(
  'topleft', 
  title='All data',
  legend=c(
    sprintf('%11s: %+.3f', 'SP500',  SP.Sharpe), 
    sprintf('%15s: %+.3f', 'Fid',    Fid.Sharpe), 
    sprintf('%13s: %+.3f', 'OH',     OH.Sharpe), 
    sprintf('%15s: %+.3f', 'f1k',    f1k.Sharpe), 
    sprintf('%s: %+.3f', 'meanReal', real.Sharpe),
    sprintf('%s', 'diff')),
  lty=1, 
  col=c(colors, 'black'), 
  lwd=c(2, 2, 2, 2, 1, 1), 
  bg=rgb(1, 1, 1, 0.8), 
  cex=0.6)
legend(
  'bottomleft', 
  title='Last year only',
  legend = c(
    sprintf('%11s: %+.3f', 'SP500',  SP.Sharpe1yr), 
    sprintf('%15s: %+.3f', 'Fid',    Fid.Sharpe1yr), 
    sprintf('%13s: %+.3f', 'OH',     OH.Sharpe1yr), 
    sprintf('%15s: %+.3f', 'f1k',    f1k.Sharpe1yr), 
    sprintf('%s: %+.3f', 'meanReal', real.Sharpe1yr),
    sprintf('%s', 'diff')),
  lty=1, 
  col=c(colors, 'black'), 
  lwd=c(2, 2, 2, 2, 2, 1, 1), 
  bg=rgb(1, 1, 1, 0.8), 
  cex=0.6)




#-------------------------------------------------------------
x <- 1:length(totalFunds)
savings.exp.mod <- lm(log(totalFunds) ~ x)
x <- last + seq(250, 3750, by=250)[1:10]
log.y <- coef(savings.exp.mod)[1] + x*coef(savings.exp.mod)[2]
y <- round(exp(log.y))
for (p in y) { cat(p, '\n') }
#-------------------------------------------------------------



#-------------------------------------------------------------
n <- length(wlsh.osc)
ds <- abs(diff(wlsh.osc))
(thresh <- quantile(ds, p=0.05))
dif <- wlsh.osc[n] - wlsh.osc[n - 1]
if (dif == 0) { 
  cat('No change. Handle this case') 
} else { change <- ifelse(dif > 0, 'up', 'down') }
powET  <- ifelse(change == 'up', 2, 0)
powFid <- ifelse(change == 'up', 1, -0.1)
below.thresh <- abs(dif) <= thresh
	
	
cat(
  sprintf(
    'Direction is: %s %s\n  Set ET exp to %.2f and Fid exp to %.2f', 
    change,
    ifelse(below.thresh, sprintf('(but below threshold: %.4f)', thresh), ''),
    powET, 
    powFid))

CASH_OUT
CASH_IN

(cash.out.fid <- CASH_OUT * FidVal[length(FidVal)])
cash.out.fid <- 27842 # Update ONLY when new threshold crossed

(cash.out.et <- CASH_OUT * OHVal[length(OHVal)])
cash.out.et <- 25305

crypto.frac <- 0.003
(target.crypo.amt <- crypto.frac * totval[length(totval)]) # in: 1060

# weight by history length
f <- sqrt
w <- c(f(50), # nya 50
       f(35), # nya 35
       f(20), #     20...
       f(10), 
       f(5),
       f(3),  # nya 3
       f(50), # sp 50
       f(35), # sp 35
       f(20), #    20...
       f(10), 
       f(5),
       f(3))  # sp 3
(w <- w / sum(w))

# 0.0001 >= 0.00005 = 5e-5
# Mon
wil3 <- c(1, 1, 1)
nas3 <- c(1,  0.9998, 0.9893)

# Tue
wil5 <- c(0.9935, 1, 0.9999)
nas5 <- c(1, 1, 1)

# Wed    
wil10 <- c(0.9999, 1, 1)
nas10 <- c(1, 1, 0.9999)

# Thu
wil20 <- c(0.9923, 1, 0.9999)
nas20 <- c(1, 1, 0.9995)

# Fri
nya35 <- c(1, 0.9999, 0)
nas35 <- c(0.9989, 0.9910, 1)

# Sat
nya50 <- c(1, 1, 1)
nas50 <- c(0.9903, 0.9902, 0.9895)



# Change must be ≥ 10%
# UPDATE: Fridays or when a percent-in value has changed
# Fid (buy and hold form Partnership Portfolio) [4-param]
(fid.amt <- FidVal[length(FidVal)]) # [96192, 119639]
(fid.pct.in <- w %*% c(nya50[1], nya35[1], wil20[1], wil10[1], wil5[1], wil3[1],
                       nas50[1], nas35[1], nas20[1], nas10[1], nas5[1], nas3[1]))
# 9975
fid.amt.in <- fid.amt * fid.pct.in
(fid.res <- fid.amt - fid.amt.in)

# OH (e*trade) - traditional strategy [3-param]
(oh.amt <- OHVal[length(OHVal)]) # [81775, 117369]
(oh.pct.in <- w %*% c(nya50[2], nya35[2],  wil20[2], wil10[2], wil5[2], wil3[2],
                      nas50[2], nas35[2],  nas20[2], nas10[2], nas5[2], nas3[2])) 
# 9075
oh.amt.in <- oh.amt * oh.pct.in
(oh.res <- oh.amt - oh.amt.in)

# For 401(k): # Next: 31 Oct (≥10%)
(f1k.total <- f1kVal[length(f1kVal)]) # [118811, 149555] [2-param]
(f1k.pct.in <- w %*% c(nya50[3], nya35[3], wil20[3], wil10[3], wil5[3], wil3[3],
                       nas50[3], nas35[3], nas20[3], nas10[3], nas5[3], nas3[3])) 
(0.8781 - 0.7227) # 15.54
(f1k.res <- 1 - f1k.pct.in)
#--------------------------------------------------------

x <- c(1, 2, 4)
x <- x / sum(x)
x * c(f1k.pct.in)

#--------------------------------------------------------
# To Save New `df` at the end of each year:
df.test <- data.frame(
  SPActual=SPActual, FidIn=FidIn, FidVal=FidVal, f1kIn=f1kIn, f1kVal=f1kVal, 
  OHIn=OHIn, OHVal=OHVal)
matplot(df.test, type='l', lty=1, col=1:7)
legend('topleft', lty=1, col=1:7, legend=names(df.test))
# Backed up previous?
save(df.test, file='~/Desktop/marketStudies/data/myHistoricTest.RData')
rm(list=ls())
load('~/Desktop/marketStudies/data/myHistoricTest.RData')
ls()
matplot(df.test, type='l', lty=1, col=1:7)
legend('topleft', lty=1, col=1:7, legend=names(df.test))
# OK?
df <- df.test
save(df, file='~/Desktop/marketStudies/data/myHistoric.RData')
# Delete test and backups