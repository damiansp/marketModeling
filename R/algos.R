#---------#---------#---------#---------#---------#---------#---------#---------
load('~/Learning/marketModeling/data/myHistoric.RData')
head(df)
tail(df)

get.daily.change <- function(x) {
  (x[2:length(x)] - x[1:(length(x) - 1)]) / x[1:(length(x) - 1)]
}


prev.last <- dim(df)[1]


sp.actual <- c(
  df$sp.actual,    3824,  3853,  3808,  3895,  3892,  3919,  3970,  3987,  3999,  
     3991,  3929,  3899,  3973,  4020,  4017,  4016,  4060,  4071,  4018,  4077,
     4119,  4180,  4136,  4111,  4164,  4118,  4082,  4090,  4137,  4136,  4148,
     4090,  4079,  3997,  3991,  4012,  3970,  3982,  3970,  3951,  3981,  4046,
     4048,  3986,  3992,  3918,  3862,  3856,  3921,  3892,  3960,  3917,  3952,
     4003,  3937,  3949,  3971,  3978,  3971,  4028,  4051,  4109,  4125,  4101,
     4090,  4105,  4109,  4109,  4092,  4146,  4138,  4137,  4155,  4155,  4130,
     4134,  4137,  4072,  4056,  4135,  4169,  4168,  4120,  4091,  4061,  4136,
     4138,  4119,  4138,  4131,  4124,  4136,  4110,  4158,  4198,  4192,  4193,
     4146,  4115,  4151,  4205,  4206,  4180,  4221,  4282,  4274,  4284,  4268,
     4294,  4299,  4339,  4369,  4373,  4426,  4410,  4389,  4366,  4382,  4348,
     4329,  4378,  4377,  4396,  4450,  4456,  4447,  4412,  4399,  4410,  4439,
     4472,  4510,  4505,  4523,  4555,  4566,  4535,  4536,  4555,  4567,  4567,
     4537,  4582,  4589,  4577,  4513,  4502,  4478,  4518,  4499,  4468,  4469,
     4464,  4490,  4438,  4404,  4370,  4370,  4400,  4388,  4436,  4376,  4406,
     4433,  4498,  4515,  4508,  4516,  4497,  4465,  4451,  4457,  4487,  4462,
     4467,  4505,  4450,  4454,  4444,  4402,  4330,  4320,  4337,  4274,  4275,
     4300,  4288,  4288,  4229,  4264,  4258,  4309)

fid.in <- c(
  df$fid.in,     161785,161785,161785,161785,161785,161785,161785,162813,162813,
   162813,162813,162813,162813,162813,162813,162813,162813,162813,164033,164033,
   164033,164033,164033,164033,164033,164033,164033,164033,164033,164744,164744,
   164744,164744,164744,164744,164744,164744,165034,165034,165034,165034,165034,
   165034,165034,165034,165034,165034,165034,165034,165034,165034,165034,165034,
   165034,165034,165034,165034,165034,165034,165034,165034,165527,165527,165527,
   165527,165527,165527,165527,165527,165969,165969,165969,165969,165969,165969,
   165969,165969,165969,165969,166251,166251,166251,166251,166251,166251,166251,
   166251,166251,166251,166251,166251,166703,166703,166703,166703,166703,166703,
   166703,166703,166703,166703,167114,167114,167114,167114,167114,167114,167114,
   167114,167114,167114,167114,167137,167137,167137,167137,167137,167137,167137,
   167137,167137,167137,167137,167137,167137,167137,167137,167137,167137,167137,
   167137,167137,167137,167137,167137,167137,167137,167137,167137,167137,167137,
   167137,167137,167137,167137,167137,167137,167137,167137,167137,167137,167137,
   167137,167137,167137,167137,167137,167137,167137,167137,167137,167137,167137,
   167137,167137,167137,167137,167137,167137,167137,167137,167137,167137,167137,
   167137,167137,167137,167137,167137,167137,167137,167137,167137,167137,167137,
   167137,167137,167137,167137,167137,167137,167137) #
fid.val <- c(
  df$fid.val,    172350,175073,172978,176119,179159,182181,185241,188878,190980,
   192214,188563,187137,191483,194849,193782,193310,196551,199449,197584,201990,
   205594,210527,207532,206046,207349,205374,203592,202266,202929,204324,206660,
   204405,203374,199846,200220,199770,197423,198398,198954,198450,200834,204734,
   203729,201713,202164,197271,193099,193960,195970,195308,198412,194950,195187,
   198013,195745,197385,198772,199996,199102,201396,202142,206474,206286,205237,
   203281,204406,204954,205873,204728,208109,206477,207843,206372,206451,205096,
   205087,204272,200760,201100,202578,203309,203257,201126,201514,202114,203845,
   204211,204354,205736,205739,204976,206813,205499,206832,207400,206952,208685,
   207316,206749,206649,207834,208340,208551,209575,211305,211194,211882,211613,
   211696,211092,212169,213715,213593,215151,214783,213686,213105,213533,211957,
   211744,212727,212829,212458,213398,213960,213811,212068,212763,214914,215769,
   216527,217844,217131,217574,216888,216996,216093,216845,216840,217091,217384,
   215337,217168,217762,217156,214695,213814,212803,213403,212745,212053,212566,
   212261,212829,210267,208921,206939,206913,207992,207421,208922,206033,207555,
   206925,209807,211130,211094,212283,211333,210673,208629,207299,208343,207092,
   206487,207206,205745,204843,204454,203127,200230,199775,200278,198582,199286,
   200987,201568,201386,198538,200167,198755,201376) #

f1k.in <- c(
  df$f1k.in,      18031, 18031, 18031, 18031, 18031, 18031, 18031, 18031, 18031,
    18031, 18031, 18031, 18933, 18933, 18933, 18933, 18933, 18933, 18933, 18933,
    18933, 19964, 19964, 19964, 19964, 19964, 19964, 19964, 19964, 19964, 19964,
    19964, 19964, 19964, 19964, 19964, 21014, 21014, 21014, 21014, 22073, 22073,
    22073, 22073, 22073, 22073, 22073, 22073, 22073, 22073, 22073, 22073, 22073,
    22073, 22073, 23114, 23114, 23114, 23114, 23114, 23114, 23114, 23114, 23114,
    23114, 24117, 24117, 24117, 24117, 24117, 24117, 24117, 24117, 24117, 25112,
    25112, 25112, 25112, 25112, 25112, 25112, 25112, 25112, 25112, 26118, 26118,
    26118, 26118, 26118, 26118, 26118, 26118, 26118, 26118, 27114, 27114, 27114,
    27114, 27114, 27114, 27114, 27114, 27114, 27114, 28080, 28080, 28080, 28080,
    28080, 28080, 28080, 28080, 28080, 28080, 28080, 28080, 28080, 28080, 29023,
    29023, 29023, 29023, 29023, 29023, 29023, 29023, 29023, 29950, 29950, 29950,
    29950, 29950, 29950, 29950, 29950, 29950, 30856, 30856, 30856, 30856, 30856,
    30856, 30856, 30856, 30856, 30856, 31768, 31768, 31768, 31768, 31768, 31768,
    31768, 31768, 31768, 31768, 32707, 32707, 32707, 32707, 32707, 32707, 32707,
    32707, 32707, 32707, 32707, 32707, 32707, 32707, 32707, 33630, 33630, 33630,
    33630, 33630, 33630, 33630, 33630, 33630, 34575, 34575, 34575, 34575, 34575,
    34575, 34575, 34575, 34575, 34575, 35566, 35566) # (1133.49)
f1k.val <- c(
  df$f1k.val,     17787, 17715, 17856, 17766, 18063, 18219, 18434, 18750, 18928,
    19082, 19184, 18853, 19601, 20022, 20342, 20315, 20283, 20555, 20750, 20388,
    20810, 22316, 22718, 22406, 22175, 22444, 22233, 22010, 21976, 22192, 22195,
    22447, 22104, 21990, 21551, 21561, 22794, 22456, 22547, 22489, 23560, 23775,
    24186, 24111, 23793, 23894, 23410, 23005, 23106, 23414, 23349, 23747, 23667,
    23704, 24034, 24955, 25265, 25362, 25291, 25240, 25564, 25808, 26162, 26245,
    26116, 26983, 27192, 27237, 27233, 27096, 27526, 27411, 27554, 27469, 28644,
    28485, 28524, 28431, 27945, 28022, 28441, 28573, 28540, 28281, 29297, 29258,
    29594, 29675, 29620, 29813, 29814, 29691, 29856, 29735, 31139, 31503, 31384,
    31526, 31228, 31093, 31424, 31765, 31894, 31822, 33136, 33435, 33438, 33463,
    33105, 33249, 33270, 33616, 33885, 33997, 34291, 34144, 33975, 33754, 35125,
    34866, 34728, 35201, 35268, 35187, 35507, 35513, 35475, 36359, 36333, 36488,
    36606, 36810, 37202, 37174, 37367, 37469, 38615, 38113, 38064, 38025, 38206,
	38124, 37846, 38347, 38407, 38365, 38841, 38820, 38764, 38886, 38684, 38377,
	38427, 38289, 38665, 38340, 39178, 38766, 38772, 39195, 39159, 39650, 38912,
	39235, 39349, 40071, 40324, 40334, 40474, 40473, 40186, 41032, 40901, 41267,
	40879, 40879, 41051, 40474, 40418, 40343, 40981, 40175, 40140, 40310, 39768,
	39849, 40113, 40147, 40239, 39564, 41148, 41068) #

self.mng.in <- c(
  df$self.mng.in,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,
     9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,
     9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,
     9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,
     9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,
     9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,
     9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,
     9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,
     9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350,  9350, 13857,
    13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857,
    13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857,
    13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857,
    13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857,
    13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857,
    13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857,
    13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857,
    13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857, 13857,
    13857, 13857, 13857, 13857, 13857, 13857, 13857)  #
self.mng.val <- c(
  df$self.mng.val, 9189,  9333,  9243,  9351,  9514,  9655,  9818,  9938, 10033,
    10109,  9904,  9785,  9978, 10155, 10111, 10134, 10231, 10379, 10181, 10433,
    10669, 10791, 10687, 10560, 10609, 10508, 10402, 10401, 10461, 10418, 10602,
    10493, 10474, 10267, 10265, 10240, 10111, 10148, 10127, 10158, 10217, 10376,
    10293, 10184, 10206,  9936,  9783,  9827,  9875,  9846,  9979,  9841,  9902,
    10033, 10043, 10157, 10238, 10220, 10221, 10276, 10399, 10559, 10616, 10566,
    10456, 10562, 10612, 10685, 10601, 10739, 10641, 10739, 10642, 10632, 10542,
    10552, 10505, 10377, 10321, 10360, 10414, 10405, 10302, 10326, 10359, 10352,
    10342, 10331, 10337, 10358, 10266, 10330, 10265, 10313, 10377, 10327, 15454,
    15418, 15321, 15332, 15407, 15517, 15547, 15564, 15647, 15639, 15644, 15603,
    15617, 15581, 15694, 15858, 15839, 15900, 15878, 15756, 15685, 15725, 15617,
    15711, 15863, 15886, 15797, 15850, 15900, 15862, 15733, 15798, 15914, 15951,
    15975, 16089, 16019, 15937, 15968, 15953, 15865, 15905, 15885, 15903, 15933,
    15724, 15905, 15943, 15904, 15702, 15745, 15723, 15661, 15639, 15601, 15639,
    15603, 15770, 15527, 15420, 15309, 15344, 15382, 15369, 15554, 15212, 15377,
    15333, 15650, 15778, 15714, 15788, 15764, 15683, 15485, 15315, 15415, 15320,
    15272, 15369, 15261, 15155, 15125, 14978, 14685, 14652, 14728, 14573, 14650,
    14788, 14821, 14755, 14521, 14647, 14555, 14758)  #

et.in <- c(
  df$et.in,       76890, 78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443,
    78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443,
    78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443,
    78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443, 78443,
    78443, 78443, 78443, 78443, 78443, 78443, 78443, 78521, 78521, 78521, 78521,
    78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521,
    78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521,
    78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521,
    78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521,
    78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521, 78521,
    78521, 78521, 78521, 78521, 78952, 78952, 78952, 78952, 78952, 78952, 78952,
    78952, 78952, 78952, 78952, 79400, 79400, 79400, 79400, 79400, 79400, 79400,
    79400, 79695, 79695, 79695, 79695, 79695, 79695, 79695, 79695, 79695, 79695,
    79695, 79695, 79961, 79961, 79961, 79961, 79961, 79961, 79961, 79961, 80119,
    80119, 80491, 80491, 80491, 80491, 80491, 80491, 80491, 80491, 80491, 80491,
    80491, 80491, 80664, 80664, 80664, 80664, 80664, 80664, 80664, 80664, 80664,
    80664, 80849, 80849, 81249, 81249, 81249, 81249, 81249, 81249, 81249, 81249,
    81303, 81303, 81303, 81303, 81303, 81303, 81303) #
et.val <-c(
  df$et.val,     123916,128480,126726,128449,130010,131945,134582,135693,137333,
   138457,136709,134475,138675,142233,140836,140850,143385,145591,142337,144726,
   148227,152885,149707,147752,149447,147340,146307,145299,146165,146828,149580,
   147802,147197,143682,144223,144493,142044,142454,142266,142069,143604,146294,
   145492,143592,143689,140455,138051,138994,140306,140332,141388,139121,139878,
   142050,139263,140911,142030,142745,142343,144160,146109,148144,147649,147818,
   146735,147330,147713,149201,147157,149311,148417,150048,149528,149705,148760,
   148579,147497,144453,144633,145930,146928,146823,145626,146117,146889,148244,
   148289,148454,149747,150115,148980,150632,149726,150106,150334,150271,151123,
   150245,149136,147819,148149,147829,148218,149145,150484,150990,151499,152095,
   150653,149046,150006,151446,151977,152524,152716,152355,151868,152457,150603,
   150081,149574,149699,149059,150891,151589,151256,150002,150225,151648,151706,
   151975,152951,152709,153063,152990,152977,152493,153247,153182,153241,153791,
   152853,153529,154288,153825,152895,152473,152230,152263,152870,152691,153282,
   153411,154828,153321,152629,150845,150996,151928,151254,152554,149539,150650,
   149941,152758,154458,154173,155222,154194,153990,152359,150941,151492,150410,
   149866,150819,149269,148220,147715,146095,142581,142234,143531,142136,143732,
   145157,146226,145295,143179,144201,143566,146047) #

rsi <- (c(
          100000,100000,100000,100000,100000,100106,100424,101112,101311,101720,
   102502,101669,101073,102367,103652,103480,103414,104617,105376,103906,105659,
   107500,109571,107624,106488,107881,106734,105919,105350,106198,106639,108007,
   106947,106668,104452,104319,104175,102555,102737,103502,103490,104154,107149,
   105722,101627,100810, 97470, 94960, 96560, 98730, 96746, 97498, 92540, 93482,
    96155, 92000, 93990, 94841, 96007, 96128, 97854, 96707,100207, 99647, 98009,
    96214, 96744, 97238, 99178, 99321,103652,102838,103685,102352,101818,100088,
    99012, 98442, 94570, 93912, 95914, 97954, 97574, 95666, 95389, 95644, 97915,
   100974,100887,106069,106992,105957,109161,106651,109158,111747,110963,111046,
   109346,108582,107469,108085,108142,107298,110176,111636,111073,113543,112788,
   113470,113293,114989,116876,116142,117443,117103,116010,114683,115784,112746,
   111870,111503,112668,111215,113304,113670,114084,110376,111140,113523,113740,
   114685,116695,115992,117456,116826,116756,114849,115827,115593,115762,117000,
   117823,121387,123949,128629,122263,124107,124017,123949,120394,119403,118387,
   117787,119059,117882,116089,113126,113157,114140,113023,115033,110962,112407,
   113674,117197,118368,114859,116950,115504,116218,113819,111110,111529,110411,
   108705,109669,108347,108185,109567,108002,105247,104221,104975,103407,104724,
   106137,106020,105178,104070,105168,104086,105526)
  / 100000)

adl <- (c(
          100000, 99991,100215, 99629,100129, 99946,100875,100664,101863,102240,
   102191,100411, 99404,100700,101797,101580,102024,102616,102316,100999,103948,
   104631,107992,107866,104794,106118,104872,105104,105180,105220,105264,106306,
   105166,105702,104659,104427,104623,102011,102325,102998,103231,103729,105450,
   104824,101934,101607, 97308, 94338, 96310, 98310, 98382, 98739, 94583, 94447,
    97567, 93319, 93711, 93457, 94866, 93494, 96321, 97681,100626,100356, 99109,
    98079, 98456, 99508,101117,100694,100479, 99380,101676,101031, 99747, 98309,
    96709, 96012, 93044, 92977, 94276, 95389, 95280, 92728, 93110, 93764, 94377,
    94573, 94722, 95343, 96514, 95525, 96691, 94865, 95457, 96726, 96679, 97985,
    96457, 95170, 94108, 94763, 94518, 94479, 97926, 99235, 98682,100823,100173,
   100536,100392,101565,103080,102624,104154,104107,103799,102301,102738,100781,
   100272,100549,101189,100018,101336,101954,102029, 99131, 99474,101422,102868,
   103583,105528,105047,106848,106958,106872,105139,107280,106405,106558,110720,
   107462,108787,109403,113439,108367,107672,107670,106065,105362,108786,110174,
   111046,111165,110425,109497,107723,107281,107047,106433,107783,105204,106488,
   107702,109877,110314,107953,109498,108545,108826,106496,104557,104230,102350,
   100913,101236, 99831, 97819, 97673, 96213, 94125, 93853, 94422, 93172, 94611,
    95708, 95857, 95119, 93724, 94273, 91697, 93290)
  / 100000)

normalize.to.index <- function(x, index) {
	x / x[index]
}


sp <- normalize.to.index(sp.actual, prev.last)
spd <- get.daily.change(sp)
fid <- fid.val / fid.in
fid <- normalize.to.index(fid, prev.last)
fidd <- get.daily.change(fid)
f1k <- f1k.val / f1k.in
f1k <- normalize.to.index(f1k, prev.last)
self.mng <- self.mng.val / self.mng.in
self.mng <- normalize.to.index(self.mng, prev.last)
self.mng.d <- get.daily.change(self.mng)
et <- et.val / et.in
et <- normalize.to.index(et, prev.last)
etd <- get.daily.change(et)
tot.in <- fid.in + f1k.in + et.in
tot.val <- fid.val + f1k.val + et.val
tot <- tot.val / tot.in
tot <- normalize.to.index(tot, prev.last)
mine.in <- fid.in + et.in + self.mng.in
mine.val <- fid.val + et.val + self.mng.val
mine <- mine.val / mine.in
mine <- normalize.to.index(mine, prev.last)

# Calculate Sharpe Ratios
get.sharpe.ratio <- function(returns, window=length(returns), rnd=3, ignore0=F) {
  if (length(returns) > window) {
    returns <- returns[(length(returns) - window):length(returns)]	  	
  }	
  returns <- returns[!is.na(returns)]
  if (ignore0) {
  	retruns <- returns[returns != 0]
  }
  round((sqrt(252) * mean(returns)) / sd(returns), rnd)
}


get.daily.returns <- function(x) { 
  n <- length(x)
  x[2:n] / x[1:(n - 1)] - 1 
}

get.sharpe.from.daily.values <- function(x, rnd=3, ignore0=F) {
  get.sharpe.ratio(get.daily.returns(x), rnd=rnd, ignore0=ignore0)
}



m <- length(sp)
n <- length(sp) - prev.last
prev <- m - n
this.year <- (prev):m
days <- -prev:(n - 1) + 1
new.days <- 0:(n - 1)
year.start <- length(tot) - length(new.days)

sp.sh       <- get.sharpe.from.daily.values(sp[this.year])
self.mng.sh <- get.sharpe.from.daily.values(self.mng[this.year], ignore0=T)
tot.sh      <- get.sharpe.from.daily.values(tot[this.year])
mine.sh     <- get.sharpe.from.daily.values(mine[this.year])
f1k.sh      <- get.sharpe.from.daily.values(f1k[this.year]) 
fid.sh      <- get.sharpe.from.daily.values(fid[this.year]) 
et.sh       <- get.sharpe.from.daily.values(et[this.year])
adl.sh      <- get.sharpe.from.daily.values(adl)
rsi.sh      <- get.sharpe.from.daily.values(rsi)

# PLOT 1: This year's returns -----------------------------------------------------
plot(
  days, 
  sp / sp[year.start], 
  type='l', 
  col='orange',
  lwd=3, 
  xlim=range(days[days >= 0]), 
  ylim=c(0.9, 1.3),
  log='y')
abline(h=seq(0, 8, 0.1), lty=2, col=rgb(0, 0, 0, 0.2))
abline(h=seq(0, 8, 0.5), lty=4, col=rgb(0, 0, 0, 0.8))
abline(v=0, lwd=2)
lines(days, tot / tot[year.start], lwd=3)
lines(days, mine / mine[year.start], col='cadetblue', lwd=3)
lines(days, fid / fid[year.start], col='darkgreen', lwd=3)
lines(days, et / et[year.start], col='purple', lwd=3)
lines(days, self.mng, col='sienna', lwd=3)
lines(days, f1k / f1k[year.start], lwd=3, col='maroon')
lines(days, (1 + tot - sp) / (1 + tot - sp)[year.start + 1], col=2)
lines(0:(length(adl) - 1), adl, lwd=3, col='limegreen')
lines(0:(length(rsi) - 1), rsi, lwd=3, col='hotpink')
legend(
  'topleft',
  lty=1,
  lwd=c(3, 3, 3, 3, 3, 3, 3, 3, 3, 1),
  col=c(
    'orange', 'darkgreen', 'purple', 'sienna', 'maroon', 'cadetblue', 'black', 
    'limegreen', 'hotpink', 'red'),
  legend=c(
    paste(sp.sh, 'S&P'),
    paste(fid.sh, 'Fid'),
    paste(et.sh, 'ETrade'),
    paste(self.mng.sh, 'Self-Managed'),
    paste(f1k.sh, '401(k) All'),
    paste(mine.sh, 'Mine'),
    paste(tot.sh, 'Total'),
    paste(adl.sh, 'Adelaide'),
    paste(rsi.sh, 'RSI'),
    paste('Diff(SP)')),
  bg=rgb(1, 1, 1, alpha=0.8))
#---------------------------------------------------------------------------------


exp.mod <- function(funds, x) {
  savings.exp.mod <- lm(log(funds) ~ x)
  log.y <- coef(savings.exp.mod)[1] + x*coef(savings.exp.mod)[2]
  exp(log.y)  
}


start <- tot.val[prev.last]
now <- tot.val[length(tot.val)]
low <- min(tot.val[(prev.last):(length(tot.val))])
high <- max(tot.val[(prev.last):(length(tot.val))])


# PLOT 2: Total funds over time --------------------------------------------------
quartz()
x <- 1:length(tot.val)
plot(
  x, 
  tot.val, 
  type='l', 
  ylim=c(0, max(tot.val)), 
  main='1 = 01 Jan 2018')#, log='y')
lines(x, exp.mod(tot.val, x), col=rgb(0, 0, 0, 1))
abline(h=start, col='grey')
abline(h=now, col='grey')
abline(h=low, col=2)
abline(h=high, col=3)
old.f1k.val <- f1k.val
old.f1k.val[790:length(f1k.val)] <- 0
lines(fid.val + old.f1k.val, col=4)
lines(x, exp.mod(fid.val + old.f1k.val, x), col=rgb(0, 0, 1, 1))
lines(f1k.val[790:length(f1k.val)], col=5)
lines(
  x[790:length(f1k.val) - 789], 
  exp.mod(f1k.val[790:length(f1k.val)], x[790:length(f1k.val)]), 
  col=rgb(0, 1, 1, 1))
lines(et.val, col=6)
lines(x, exp.mod(et.val, x), col=rgb(1, 0, 1, 1))
smv <- self.mng.val[self.mng.val > 1]
x <- 1:length(smv)
lines(smv, col='sienna')
lines(x, exp.mod(smv, x), col='sienna')
legend(
  'topleft',
  lty=1,
  col=c('black', 'blue', 'magenta', 'cyan', 'sienna'),
  legend=c(
    paste('Total: ', tot.val[length(tot.val)]),
    'Fidelity', 
    'ETrade', 
    '401(k)', 
    'Self-Managed'),
  bg='white')
#---------------------------------------------------------------------------------


x <- 1:length(tot.val)
savings.exp.mod <- lm(log(tot.val) ~ x)
x <- prev.last + seq(250, 3750, by=250)[1:13]
log.y <- coef(savings.exp.mod)[1] + x*coef(savings.exp.mod)[2]
y <- round(exp(log.y))
for (p in y) { cat(p, '\n') }

(fid.amt <- fid.val[length(fid.val)])                # [179159 217844]
(et.amt <- et.val[length(et.val)])                   # [130010 154288]
(f1k.total <- f1k.val[length(f1k.val)])              # [ 18063  41267] 
(self.mng.amt <- self.mng.val[length(self.mng.val)]) # [  9514  16089]
(rsi[length(rsi)] * 100000)
(adl[length(adl)] * 100000)
(pct.invested)


#--------------------------------------------------------
# To Save New `df` at the end of each year:
#df.test <- data.frame(
#  sp.actual=sp.actual, fid.in=fid.in, fid.val=fid.val, f1k.in=f1k.in, 
#  f1k.val=f1k.val, et.in=et.in, et.val=et.val, self.mng.in=self.mng.in, 
#  self.mng.val=self.mng.val)
#matplot(df.test, type='l', lty=1, col=1:7)
#legend('topleft', lty=1, col=1:7, legend=names(df.test))
# Backed up previous?
#save(df.test, file='~/Learning/marketModeling/data/myHistoricTest.RData')
#rm(list=ls())
#load('~/Learning/marketModeling/data/myHistoricTest.RData')
#ls()
#matplot(df.test, type='l', lty=1, col=1:7)
#legend('topleft', lty=1, col=1:7, legend=names(df.test))
# OK?
#df <- df.test
#save(df, file='~/Learning/marketModeling/data/myHistoric.RData')
# Delete test and backups
